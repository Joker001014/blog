{"componentChunkName":"component---src-templates-blog-post-js","path":"/003_Lanqiaobei/","result":{"data":{"site":{"siteMetadata":{"title":"JokerDebug"}},"markdownRemark":{"id":"2d55a82e-76b3-5147-8714-07b2792df7d8","excerpt":"Github代码仓库链接 一、前言 承接上文，本文将继续介绍剩余蓝桥杯涉及模块（DS1302、PCF8591、AT24C02、PWM、串口通信、NE555以及超声波测距），为大家做出详细编程指导。 二、DS1302 时钟模块 笔者将基于蓝桥杯官方给的赛点资源包（蓝桥杯单片机设计与开发…","html":"<p><a href=\"https://github.com/Joker001014/LanQiaoCup\">Github代码仓库链接</a></p>\n<h2>一、前言</h2>\n<p>承接上文，本文将继续介绍剩余蓝桥杯涉及模块（DS1302、PCF8591、AT24C02、PWM、串口通信、NE555以及超声波测距），为大家做出详细编程指导。</p>\n<h2>二、DS1302 时钟模块</h2>\n<p>笔者将基于蓝桥杯官方给的赛点资源包（<a href=\"https://github.com/Joker001014/LanQiaoCup/tree/main/%E8%B5%9B%E7%82%B9%E8%B5%84%E6%BA%90%E6%95%B0%E6%8D%AE%E5%8C%85_SCM\">蓝桥杯单片机设计与开发_赛点资源数据包</a>）进行编程，为大家讲解编程调用各语句的含义，帮助大家编写温度传感器的程序，也便于大家记忆。</p>\n<h3>1、导入底层驱动代码</h3>\n<p>读者可下载赛点资源包，解压后可得到以下图片所示文件。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/93f78654fba2229b6f46f4f17b49c028/828fb/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2kUKMf/EABgQAAIDAAAAAAAAAAAAAAAAAAABAhAx/9oACAEBAAEFAk7joz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAQAGPwJr/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERMRBRIXGR/9oACAEBAAE/IeRpwKVqzzE32XP/2gAMAwEAAgADAAAAEDTP/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QV//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAEUGxITGRwf/aAAgBAQABPxBEWt0AdxWUEi0z7nO/DPhuaZ//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/93f78654fba2229b6f46f4f17b49c028/828fb/1.jpg\"\n        srcset=\"/blog/static/93f78654fba2229b6f46f4f17b49c028/ff44c/1.jpg 158w,\n/blog/static/93f78654fba2229b6f46f4f17b49c028/a6688/1.jpg 315w,\n/blog/static/93f78654fba2229b6f46f4f17b49c028/828fb/1.jpg 630w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n我们双击打开文件“3-底层驱动代码参考”文件，将得到以下 <code class=\"language-text\">.c</code> 和 <code class=\"language-text\">.h</code> 文件。接下来将 <code class=\"language-text\">ds1302.c</code> 和 <code class=\"language-text\">ds1302.h</code> 文件拷贝到工程所在文件夹中，并在编译器中将这两个文件导入，便可以开始编写程序了。\r\n![[Pasted image 20231013184631.png]]</p>\n<h3>2、DS1302驱动函数</h3>\n<p>首先，在编写驱动函数之前，我们需要在底层驱动代码<code class=\"language-text\">ds1302.c</code>文件中编写 <strong>时间读写函数</strong>。我们可以打开赛点资源数据包中的文件“5-竞赛板芯片资料”。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e5f3caa93863fbe80e44f65abed177c5/f7974/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAezc2aD/xAAYEAACAwAAAAAAAAAAAAAAAAACEBEhMv/aAAgBAQABBQKbQ6X/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAbEAACAwADAAAAAAAAAAAAAAAAARExUSFxof/aAAgBAQABPyFPJRwS8JeelhvY7P/aAAwDAQACAAMAAAAQpB//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCq/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQEAAgMAAAAAAAAAAAAAAREAEFFhobH/2gAIAQEAAT8QKwsECYGwhe94memZ+HB//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/e5f3caa93863fbe80e44f65abed177c5/828fb/2.jpg\"\n        srcset=\"/blog/static/e5f3caa93863fbe80e44f65abed177c5/ff44c/2.jpg 158w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/a6688/2.jpg 315w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/828fb/2.jpg 630w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/0ede0/2.jpg 945w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/f7974/2.jpg 1097w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>打开“DS1302”芯片手册。笔者将借助芯片手册中的资料编写温度读取函数并为大家讲解。\r\n![[Pasted image 20231013185402.png]]</p>\n<p>时间写函数：编写时间写函数，即设置时间模块的初始时间函数。我们只需要通过调用底层驱动函数中的 ds1302 写入字节函数。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 时间写函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">DS1302_write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>time_tab<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token function\">Write_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x8e</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                      <span class=\"token comment\">// 写开始初始化函数</span>\r\n\t<span class=\"token function\">Write_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x84</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 时（十进制->十六进制）</span>\r\n\t<span class=\"token function\">Write_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 分（十进制->十六进制）</span>\r\n\t<span class=\"token function\">Write_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 秒（十进制->十六进制）</span>\r\n\t<span class=\"token function\">Write_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x8e</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                      <span class=\"token comment\">// 写结束初始化函数</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>其中，在编写时间写函数指令可通过查阅芯片资料手册，不需要死记硬背。</p>\n<ul>\n<li>地址 0x8e 即为写初始化地址</li>\n<li>地址 0x84、0x82、0x80 分别对应 时、分、秒 的写入地址</li>\n</ul>\n<p>![[Pasted image 20231013190031.png]]</p>\n<p>时间读函数：编写时间读函数，即从时间模块中得到当前时间。我们只需要通过调用底层驱动函数中的ds1302读取字节函数。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 时间读函数</span>\r\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> hour<span class=\"token punctuation\">,</span>minute<span class=\"token punctuation\">,</span>second<span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 设置全局变量</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">DS1302_read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\thour <span class=\"token operator\">=</span> <span class=\"token function\">Read_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x85</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 读取 - 时（从指定地址读取）</span>\r\n\tminute <span class=\"token operator\">=</span> <span class=\"token function\">Read_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x83</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 读取 - 分（从指定地址读取）</span>\r\n\tsecond <span class=\"token operator\">=</span> <span class=\"token function\">Read_Ds1302_Byte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x81</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 读取 - 秒（从指定地址读取）</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>同样可以查阅上述芯片资料手册，不需要死记硬背，此处将不再赘述。\r\n![[Pasted image 20231013190436.png]]</p>\n<p>在编写完时间读写函数后务必要在 <code class=\"language-text\">ds1302.h</code> 文件中声明函数，才可在主函数中调用。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">__DS1302_H</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">__DS1302_H</span></span>\r\n\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">DS1302_write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>time_tab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">DS1302_read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> hour<span class=\"token punctuation\">,</span>minute<span class=\"token punctuation\">,</span>second<span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 全局变量存储 时、分、秒</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<h3>3、主函数调用</h3>\n<p>在主函数中调用时间模块底层函数，首先需要在主函数开头包含驱动 ds1302 头文件。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span>   <span class=\"token comment\">//头文件</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ds1302.h\"</span>        <span class=\"token comment\">//包含DS18B20驱动头文件</span></span></code></pre></div>\n<p>除此之外，笔者将个位数后的小数点显示出来，采取的方法是在定义 tab 数组时，在后面再定义十个小数点点亮的数，即通过将 0~9 对应的高八位减去 8，即可点亮小数点 dp 位。再在数码管显示的缓冲区上加上 11，即可显示带小数点的数字（与上文一致，下文将不再继续赘述）。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">u8 code tab<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x24</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x19</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//定义数组存放数码管数字状态</span>\r\n\t\t       <span class=\"token comment\">//  0 ,  1 ,  2 ,  3 ,  4 ,  5 ,  6 ,  7 ,  8 ,  9 , 灭 , 0. , 1. , 2. , 3. , 4. , 5. , 6. , 7. , 8. , 9. </span></code></pre></div>\n<p>main主函数\r\n主程序调用比较简单，下文中实现了 <strong>初始化 ds1302 时钟模块，并通过矩阵按键修改当前的时间值，并在数码管中实时显示时间</strong>。由于考虑初学者基础较为薄弱，因此将完整的 main.cpp 代码贴出来，包含中断函数、矩阵键盘、数码管显示等，并且在关键处进行了注释，希望对大家有所帮助。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 包含头文件</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ds1302.h\"</span></span>\r\n\r\n<span class=\"token comment\">// 数据类型定义</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u8</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u16</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span></span></span>\r\n\r\n<span class=\"token comment\">// 8位数码管状态</span>\r\nu8 dspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \r\nu8 code tab<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x24</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x19</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x89</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xc1</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xbf</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\t             <span class=\"token comment\">//  0 ,  1 ,  2 ,  3 ,  4 ,  5 ,  6 ,  7 ,  8 ,  9 , 灭 , 0. , 1. , 2. , 3. , 4. , 5. , 6. , 7. , 8. , 9. ,  H ,  U ,  -  ; </span>\r\nu8 time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">23</span><span class=\"token punctuation\">,</span><span class=\"token number\">59</span><span class=\"token punctuation\">,</span><span class=\"token number\">50</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 初始化时间数组</span>\r\nu8 dspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\nbit clock_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>key_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 标注位</span>\r\n\r\n<span class=\"token comment\">// 中断函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">//2毫秒@12.000MHz</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tAUXR <span class=\"token operator\">|=</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器时钟1T模式</span>\r\n\tTMOD <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0xF0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时器模式</span>\r\n\tTL0 <span class=\"token operator\">=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTH0 <span class=\"token operator\">=</span> <span class=\"token number\">0xA2</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//清除TF0标志</span>\r\n\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器0开始计时</span>\r\n\t\r\n\tET0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//开定时中断</span>\r\n\tEA<span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t\t<span class=\"token comment\">//开总中断</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 573锁存器封装成函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">door</span><span class=\"token punctuation\">(</span>u8 choose<span class=\"token punctuation\">,</span>u8 input<span class=\"token punctuation\">)</span>\t   \r\n<span class=\"token punctuation\">{</span>\r\n\tP2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P2 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> choose<span class=\"token punctuation\">;</span>\r\n\tP0 <span class=\"token operator\">=</span> input<span class=\"token punctuation\">;</span>\r\n\tP2 <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">;</span>\t\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 关数码管</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>        \r\n<span class=\"token punctuation\">{</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 初始化，关灯、蜂鸣器、数码管</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t     \r\n<span class=\"token punctuation\">{</span>\r\n \t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 数码管显示函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t\t\r\n<span class=\"token punctuation\">{</span>\t\t\t  \r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//消隐</span>\r\n\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x01</span><span class=\"token operator\">&lt;&lt;</span>dspcom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span>tab<span class=\"token punctuation\">[</span>dspbuf<span class=\"token punctuation\">[</span>dspcom<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>dspcom <span class=\"token operator\">>=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>     <span class=\"token comment\">//or dspcom &amp;= 0x07;</span>\r\n\t\tdspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 矩阵键盘，接KBD</span>\r\nu8 keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span>keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\nu8 <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t                              \t\r\n<span class=\"token punctuation\">{</span>\r\n    u8 key_m<span class=\"token punctuation\">,</span>cal<span class=\"token punctuation\">;</span>\r\n    \r\n    P3 <span class=\"token operator\">=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">;</span>P42<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>P44<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n  \tP36<span class=\"token operator\">=</span>P42<span class=\"token punctuation\">;</span>P37<span class=\"token operator\">=</span>P44<span class=\"token punctuation\">;</span>\t\t\t   <span class=\"token comment\">//变量替换</span>\r\n    key_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">!=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">)</span> \r\n        keypress<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n   <span class=\"token keyword\">else</span>\r\n        keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> \r\n    \r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>keypress <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n\t\t  keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t  \tkeyread <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t\t  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0x70</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>                \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xb0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xd0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xe0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        \r\n        P3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tP36<span class=\"token operator\">=</span>P42<span class=\"token punctuation\">;</span>P37<span class=\"token operator\">=</span>P44<span class=\"token punctuation\">;</span>\t\t\t   <span class=\"token comment\">//变量替换</span>\r\n        key_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        \r\n\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n\t\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0e</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>                \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0d</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0b</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x07</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    P3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tP36<span class=\"token operator\">=</span>P42<span class=\"token punctuation\">;</span>P37<span class=\"token operator\">=</span>P44<span class=\"token punctuation\">;</span>\t\t\t                <span class=\"token comment\">//变量替换</span>\r\n    key_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>keyread <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">==</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">//松手检测</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> keyvalue<span class=\"token punctuation\">;</span>\t\r\n    <span class=\"token punctuation\">}</span>\r\n    \r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span>  \r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">//````````````````````````````````主函数````````````````````````````````````</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t\t\r\n<span class=\"token punctuation\">{</span>\r\n    u8 key_re<span class=\"token punctuation\">,</span>clock_w<span class=\"token punctuation\">;</span>\r\n\t<span class=\"token comment\">// 初始化</span>\r\n\t<span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token comment\">// 中断初始化</span>\r\n\t<span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token comment\">// DS1302初始化</span>\r\n\t<span class=\"token function\">DS1302_write</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n \t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_flag<span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\tkey_re <span class=\"token operator\">=</span> <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_re <span class=\"token operator\">!=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span>\r\n\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_re<span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t<span class=\"token comment\">// 按键调整 时</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">13</span><span class=\"token operator\">:</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span>\r\n\t\t\t\t\t\t\t\t\t\ttime_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t\t\t\t\t<span class=\"token function\">DS1302_write</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">12</span><span class=\"token operator\">:</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n\t\t\t\t\t\t\t\t\t\ttime_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">23</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t\t\t\t\t<span class=\"token function\">DS1302_write</span><span class=\"token punctuation\">(</span>time_tab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">default</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token comment\">// 实时更新当前时间并存入 time_tab ,用于按键调整时间时修改</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>clock_flag<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>clock_w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tclock_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token function\">DS1302_read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> hour<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> hour<span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">23</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minute<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minute<span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">23</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> second<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> second<span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\ttime_tab<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> hour<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token operator\">+</span>hour<span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\ttime_tab<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minute<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token operator\">+</span>minute<span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t\ttime_tab<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> second<span class=\"token operator\">/</span><span class=\"token number\">16</span><span class=\"token operator\">*</span><span class=\"token number\">10</span><span class=\"token operator\">+</span>second<span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 中断服务函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">timer0</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> interrupt <span class=\"token number\">1</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">static</span> u8  t_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>t_50ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//MAX = 500 ms</span>\r\n\r\n\t<span class=\"token comment\">//不需要重载装载值</span>\r\n\t\r\n\t<span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//数码管显示函数放里面</span>\r\n\r\n\tt_20ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\tt_50ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_20ms <span class=\"token operator\">>=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">//每20ms扫描一次按键</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_50ms <span class=\"token operator\">>=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t    t_50ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tclock_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>至此，本次 DS1302 时钟程序已编写完毕。</p>","frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_DS1302","date":"May 15, 2021","description":"本文介绍了蓝桥杯单片机编程大赛DS1302时钟模块的编程使用方法。"}},"previous":{"fields":{"slug":"/002_Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_DS18B20"}},"next":{"fields":{"slug":"/004_Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_PCF8591"}}},"pageContext":{"id":"2d55a82e-76b3-5147-8714-07b2792df7d8","previousPostId":"5c4bee41-8355-5207-900c-51c12e934afd","nextPostId":"68e3f69d-40e6-537f-bec1-c4055d9906d3"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}