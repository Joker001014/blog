{"componentChunkName":"component---src-templates-blog-post-js","path":"/008 Lanqiaobei/","result":{"data":{"site":{"siteMetadata":{"title":"JokerDebug"}},"markdownRemark":{"id":"cfbbc231-c0ef-5db5-8b55-10b4e4529f4e","excerpt":"Github代码仓库链接 一、前言 承接上文，本文将继续介绍剩余蓝桥杯涉及模块（NE555以及超声波测距），为大家做出详细编程指导。 二、NE555 NE555，也称为LM555，是一种经典的集成电路（IC）芯片，是一款常用的定时器和脉冲宽度调制（PWM）发生器。NE55…","html":"<p><a href=\"https://github.com/Joker001014/LanQiaoCup\">Github代码仓库链接</a></p>\n<h2>一、前言</h2>\n<p>承接上文，本文将继续介绍剩余蓝桥杯涉及模块（NE555以及超声波测距），为大家做出详细编程指导。</p>\n<h2>二、NE555</h2>\n<p>NE555，也称为LM555，是一种经典的集成电路（IC）芯片，是一款常用的定时器和脉冲宽度调制（PWM）发生器。NE555被广泛应用于各种电子电路中，例如时钟电路、脉冲发生器、电子闹钟、计时器、PWM控制器等，是蓝桥杯比赛中常见的一道题目。</p>\n<h3>1、NE555原理剖析</h3>\n<p>NE555实现起来较简单，只需设置一个定时器1用于计时，计数器0用于计数，每秒计算NE555接收脉冲数，实现频率计算，代码如下所示。</p>\n<h3>2、整体代码</h3>\n<p>由于考虑初学者基础较为薄弱，因此将完整的 main.cpp 代码贴出来，包含中断函数、矩阵键盘、数码管显示等，并且在关键处进行了注释，希望对大家有所帮助。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 包含头文件</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span></span>\r\n<span class=\"token comment\">// 数据类型定义</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u8</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u16</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span></span></span>\r\n<span class=\"token comment\">// 8位数码管状态</span>\r\nu8 dspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \r\nu8 code tab<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n    \r\nu8 dspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\nbit key_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>NE555_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// 573锁存器封装成函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">door</span><span class=\"token punctuation\">(</span>u8 choose<span class=\"token punctuation\">,</span>input<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tP2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P2 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> choose<span class=\"token punctuation\">;</span>\r\n\tP0 <span class=\"token operator\">=</span> input<span class=\"token punctuation\">;</span>\r\n\tP2 <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">;</span>\t\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 关数码管</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 关灯、蜂鸣器</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n \t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 数码管显示函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\t\t\t  \r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x01</span><span class=\"token operator\">&lt;&lt;</span>dspcom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span>tab<span class=\"token punctuation\">[</span>dspbuf<span class=\"token punctuation\">[</span>dspcom<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>dspcom <span class=\"token operator\">>=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\r\n\t\tdspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 矩阵键盘，接KBD</span>\r\nu8 keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span>keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\nu8 <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    u8 key_m<span class=\"token punctuation\">,</span>cal<span class=\"token punctuation\">;</span>\r\n    \r\n    P3 <span class=\"token operator\">=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">;</span>P42 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n  \tP36 <span class=\"token operator\">=</span> P42<span class=\"token punctuation\">;</span>P37 <span class=\"token operator\">=</span> P44<span class=\"token punctuation\">;</span>\r\n    key_m <span class=\"token operator\">=</span> P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0xf0</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">!=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">)</span> \r\n        keypress<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n   <span class=\"token keyword\">else</span>\r\n        keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> \r\n    \r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>keypress <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n\t\t  keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t  \tkeyread <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t\t  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0x70</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>                \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xb0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xd0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xe0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        \r\n        P3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        key_m <span class=\"token operator\">=</span> P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>\r\n        \r\n\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n\t\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0e</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>                \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0d</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0b</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x07</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    P3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    key_m <span class=\"token operator\">=</span> P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>\r\n\t\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>keyread<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">==</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> keyvalue<span class=\"token punctuation\">;</span>\t\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span> \r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 定时器1、计数器0 初始化函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer_Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">//2毫秒@12.000MHz</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tAUXR <span class=\"token operator\">|=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器时钟1T模式</span>\r\n\t<span class=\"token comment\">//△注意：需要用 |=</span>\r\n\tTMOD <span class=\"token operator\">|=</span> <span class=\"token number\">0x05</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器T1(00：自动重装载)  计数器T0(01：16位不重装，TL0、TH0全用)    0000 0101(第3、6位，0：定时，1：计数)</span>\r\n\tTL1 <span class=\"token operator\">=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTH1 <span class=\"token operator\">=</span> <span class=\"token number\">0xA2</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTF1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//清除TF1标志</span>\r\n\tTR1 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器1开始计时</span>\r\n\t\r\n  TR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">//开计数器0</span>\r\n\tET0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\tET1 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\tEA <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">//打开总中断        </span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>          <span class=\"token comment\">//****************************************************************************************************</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tu8 key_re<span class=\"token punctuation\">,</span>NE555_w <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\tu16 freq <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">//定义频率</span>\r\n\t\r\n\t<span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">Timer_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_flag<span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\tkey_re <span class=\"token operator\">=</span> <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_re <span class=\"token operator\">!=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span>\r\n\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_re<span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">7</span><span class=\"token operator\">:</span>NE555_w <span class=\"token operator\">^=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//用不了num_close()</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token operator\">:</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span><span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x55</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token comment\">// 每秒计算NE555频率</span>\r\n\t\t<span class=\"token comment\">// 短接signal和P34，改变Rb3可改变频率</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>NE555_flag<span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tNE555_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//关计数器0</span>\r\n\t\t\t\r\n\t\t\tfreq <span class=\"token operator\">=</span> TL0<span class=\"token operator\">+</span>TH0<span class=\"token operator\">*</span><span class=\"token number\">256</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\tTH0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//清空计数</span>\r\n\t\t\tTL0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//清空计数</span>\r\n\t\t\t\r\n\t\t\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//打开计数器0</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token comment\">// 数码管实时显示NE555检测的频率值</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>key_flag<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>NE555_w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> freq<span class=\"token operator\">/</span><span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> freq<span class=\"token operator\">%</span><span class=\"token number\">10000</span><span class=\"token operator\">/</span><span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> freq<span class=\"token operator\">%</span><span class=\"token number\">1000</span><span class=\"token operator\">/</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> freq<span class=\"token operator\">%</span><span class=\"token number\">100</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> freq<span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 定时器 1 中断服务函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">timer1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> interrupt <span class=\"token number\">3</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">static</span> u8 t_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token keyword\">static</span> u16 t_1000ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\tt_20ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\tt_1000ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_20ms <span class=\"token operator\">>=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token comment\">// 1s计时，用于统计1s内NE555接收脉冲数->计算频率</span>\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_1000ms <span class=\"token operator\">>=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_1000ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tNE555_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>至此，本次 NE555 已介绍完毕。</p>","frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_NE555","date":"May 30, 2021","description":"本文介绍了蓝桥杯单片机编程大赛NE555模块的编程使用方法。"}},"previous":{"fields":{"slug":"/007 Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_串口通信"}},"next":{"fields":{"slug":"/009 Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_超声波测距"}}},"pageContext":{"id":"cfbbc231-c0ef-5db5-8b55-10b4e4529f4e","previousPostId":"aa4df4cc-ad0e-5b3a-a655-bc27b6ec9411","nextPostId":"a94ec4cc-c5e8-5490-9ddc-bfe822a34fff"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}