{"componentChunkName":"component---src-templates-blog-post-js","path":"/014_HIT_OS_Lab5/","result":{"data":{"site":{"siteMetadata":{"title":"JokerDebug"}},"markdownRemark":{"id":"bf47b7f4-595d-501d-b207-be0c83d803f8","excerpt":"Github代码仓库链接 本节将更新哈工大《操作系统》课程第五个 Lab 实验 基于内核栈切换的进程切换。按照实验书要求，介绍了非常详细的实验操作流程，并提供了超级无敌详细的代码注释。 Linux0.11 采用 TSS…","html":"<p><a href=\"https://github.com/Joker001014/HIT-OSlab\">Github代码仓库链接</a></p>\n<p>本节将更新哈工大《操作系统》课程第五个 Lab 实验 <strong>基于内核栈切换的进程切换</strong>。按照实验书要求，介绍了非常详细的实验操作流程，并提供了超级无敌详细的代码注释。</p>\n<blockquote>\n<p>Linux0.11 采用 TSS 和一条指令完成任务切换，虽然简单但执行时间长。\r\n堆栈实现任务切换更快，且可以使用指令流水的并行优化技术</p>\n</blockquote>\n<p><strong>实验目的：</strong></p>\n<blockquote>\n<ul>\n<li>深入理解进程和进程切换的概念；</li>\n<li>综合应用进程、CPU 管理、PCB、LDT、内核栈、内核态等知识解决实际问题；</li>\n<li>开始建立系统认识。</li>\n</ul>\n</blockquote>\n<p><strong>实验任务：</strong></p>\n<blockquote>\n<p>本次实践项目就是将 Linux 0.11 中采用的 TSS 切换部分去掉，取而代之的是基于堆栈的切换程序。具体的说，就是将 Linux 0.11 中的 switch_to 实现去掉，写成一段基于堆栈切换的代码。\r\n1、编写汇编程序 switch_to：\r\n2、完成主体框架；\r\n3、在主体框架下依次完成 PCB 切换、内核栈切换、LDT 切换等；\r\n4、修改 fork()，由于是基于内核栈的切换，所以进程需要创建出能完成内核栈切换的样子。\r\n5、修改 PCB，即 task_struct 结构，增加相应的内容域，同时处理由于修改了 task_struct 所造成的影响。\r\n6、用修改后的 Linux 0.11 仍然可以启动、可以正常使用。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>文件名</th>\n<th>介绍</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>hit-操作系统实验指导书.pdf</td>\n<td>哈工大OS实验指导书</td>\n</tr>\n<tr>\n<td>Linux内核完全注释(修正版v3.0).pdf</td>\n<td>赵博士对Linux v0.11 OS进行了详细全面的注释和说明</td>\n</tr>\n<tr>\n<td>file1615.pdf</td>\n<td>BIOS 涉及的中断数据手册</td>\n</tr>\n<tr>\n<td>hit-oslab-linux-20110823.tar.gz</td>\n<td>hit-oslab 实验环境</td>\n</tr>\n<tr>\n<td>gcc-3.4-ubuntu.tar.gz</td>\n<td>Linux v0.11 所使用的编译器</td>\n</tr>\n<tr>\n<td><a href=\"https://blog.csdn.net/weixin_53159274/article/details/137796343?spm=1001.2014.3001.5501\">Bochs 汇编级调试指令</a></td>\n<td>bochs 基本调试指令大全</td>\n</tr>\n<tr>\n<td><a href=\"https://blog.csdn.net/yueyueniaolzp/article/details/82178954\">最全ASCII码对照表0-255</a></td>\n<td>屏幕输出字符对照的 ASCII 码</td>\n</tr>\n<tr>\n<td><a href=\"https://blog.csdn.net/weixin_53159274/article/details/138074386?spm=1001.2014.3001.5501\">x86_64 常用寄存器大全</a></td>\n<td>x86_64 常用寄存器大全</td>\n</tr>\n</tbody>\n</table>\n<h3>一、编写 switch_to()</h3>\n<p>在 <code class=\"language-text\">kernel/sched.c</code> 文件中修改 switch_to() 函数传入参数。</p>\n<ul>\n<li>目标进程PCB指针</li>\n<li>下一个进程对应的局部描述符表</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tss_struct</span> <span class=\"token operator\">*</span>tss <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>init_task<span class=\"token punctuation\">.</span>task<span class=\"token punctuation\">.</span>tss<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span>next<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span> p<span class=\"token punctuation\">;</span>\r\n\t<span class=\"token comment\">// 声明 pnext</span>\r\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token operator\">*</span>pnext <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>init_task<span class=\"token punctuation\">.</span>task<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 定义目标进程PCB指针</span>\r\n\r\n<span class=\"token comment\">//  ....</span>\r\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        c <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n        next <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token comment\">// 给 pnext 赋值</span>\r\n        pnext <span class=\"token operator\">=</span> task<span class=\"token punctuation\">[</span>next<span class=\"token punctuation\">]</span>\r\n<span class=\"token comment\">//  ....</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>state <span class=\"token operator\">==</span> TASK_RUNNING <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>counter <span class=\"token operator\">></span> c<span class=\"token punctuation\">)</span>\r\n                c <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>counter<span class=\"token punctuation\">,</span> next <span class=\"token operator\">=</span> i<span class=\"token punctuation\">,</span> pnext <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">//  ....</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token function\">switch_to</span><span class=\"token punctuation\">(</span>pnext<span class=\"token punctuation\">,</span> <span class=\"token function\">_LDT</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>在 <code class=\"language-text\">kernel/system_call.s</code> 中添加 switch_to 实现（代码中给出了非常详细的注释）</p>\n<div class=\"gatsby-highlight\" data-language=\"asm\"><pre class=\"language-asm\"><code class=\"language-asm\">KERNEL_STACK = 12\r\nESP0 = 4\r\n\r\nswitch_to:\r\n\t! c语言调用汇编，处理栈帧ebp\r\n    pushl %ebp       ! 保存帧指针\r\n    movl %esp,%ebp   ! 将栈指针赋给帧指针，即在栈顶创建新函数栈帧\r\n    ! 保存了几个常用的寄存器值\r\n    pushl %ecx\r\n    pushl %ebx\r\n    pushl %eax\r\n    ! ebp+4：返回地址；ebp+8：第一个参数；ebp+12：第二个参数\r\n    movl 8(%ebp),%ebx  ! 将下一个进程PCB指针存入ebx\r\n    cmpl %ebx,current  ! 判断下一个进程是否为当前进程\r\n    je 1f              ! 跳转去弹出保存的寄存器值并返回，f-向前\r\n    \r\n! 完成 PCB 切换（修改current）\r\n    movl %ebx,%eax\r\n\txchgl %eax,current  ! 交换eax和current的值\r\n\t! eax-指向当前进程，ebx、current-指向下一个进程\r\n\t\r\n! 重写 TSS 中的内核栈指针（修改TSS的第四个字段）\r\n\t! 寻找当前进程的内核栈，为了从用户栈切换到内核栈\r\n    movl tss,%ecx\r\n    ! 一页内存大小为4KB，PCB位于内存低地址，栈位于内存的高地址\r\n    addl $4096,%ebx       ! 得到新进程的栈指针\r\n    movl %ebx,ESP0(%ecx)  ! 将下一进程内核栈指针存入 TSS 的 esp0\r\n    \r\n! 内核栈的切换（即修改esp）\r\n\t! eax-指向当前进程\r\n    movl %esp,KERNEL_STACK(%eax)  ! 将当前栈指针保存到当前进程的内核栈指针字段中，确保下次切换回来可以恢复\r\n    movl 8(%ebp),%ebx             ! 将下一个进程PCB指针存入ebx\r\n    movl KERNEL_STACK(%ebx),%esp  ! 将栈指针设置为下一进程的内核栈指针\r\n    \r\n! LDT 的切换（修改LDTR）\r\n\tmovl 12(%ebp), %ecx    ! 取出第二个参数，即LDT(next)\r\n    lldt %cx               ! 修改 LDTR 寄存器，实现用户态程序 LDT 映射表切换\r\n\t! 段寄存器fs：访问进程的用户态内存\r\n\t! 现在的 fs 指向上一个进程的用户态内存，而现在LDT切换完成，用户态内存已经改变，所以需要重取fs\r\n    movl $0x17,%ecx\r\n\tmov %cx,%fs\r\n\r\n! nonsense\r\n    cmpl %eax,last_task_used_math \r\n    jne 1f\r\n    clts\r\n\r\n! 恢复寄存器值并返回\r\n1:    popl %eax\r\n    popl %ebx\r\n    popl %ecx\r\n    popl %ebp\r\nret\r\n\r\n! 提示：汇编指令后的l表示操作32位数据（b-8, w-16, l-32, q-64)</code></pre></div>\n<p>需要修改的地方：</p>\n<ol>\n<li>inux0.11 进程控制块(<code class=\"language-text\">pcb</code>)中是没有保存内核栈信息的寄存器，所以需要在 <code class=\"language-text\">include/linux/sched.h</code> 文件中<strong>PCB定义</strong> <code class=\"language-text\">task_struct</code> 中添加<strong>内核栈指针</strong>：</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// PCB 定义</span>\r\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">long</span> state<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">long</span> counter<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">long</span> priority<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">long</span> kernelstack<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token comment\">//......</span></code></pre></div>\n<ol start=\"2\">\n<li>由于PCB定义改变，所以0号进程的PCB初始化也要新增添加的内核栈指针初始化。在<code class=\"language-text\">include/linux/sched.h</code> 文件中 <code class=\"language-text\">INIT_TASK</code> 定义上添加内核栈指针初始化（即在第四项添加）</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">INIT_TASK</span> <span class=\"token punctuation\">\\</span>\r\n<span class=\"token comment\">/* state etc */</span>    <span class=\"token expression\"><span class=\"token punctuation\">{</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span>PAGE_SIZE<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>init_task<span class=\"token punctuation\">,</span> </span><span class=\"token punctuation\">\\</span>\r\n<span class=\"token comment\">/* signals */</span>    <span class=\"token expression\"><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> </span></span>\\</code></pre></div>\n<blockquote>\n<p>提示：Linux 0.11 进程的内核栈和该进程的 PCB 在同一页内存上（一块 4KB 大小的内存），其中 PCB 位于这页内存的低地址，栈位于这页内存的高地址</p>\n</blockquote>\n<ol start=\"3\">\n<li>在 <code class=\"language-text\">kernel/sched.h</code> 文件中声明一下使用 switch_to()</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 使用switch_to还需要声明一下</span>\r\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">void</span> <span class=\"token function\">switch_to</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token operator\">*</span>pnext<span class=\"token punctuation\">,</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ldt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<h3>二、修改 fork.c</h3>\n<blockquote>\n<p>通过压栈的方式，把进程的<strong>用户栈</strong>和<strong>内核栈</strong>通过内核栈中的 <code class=\"language-text\">SS:ESP</code>，<code class=\"language-text\">CS:IP</code> 关联在一起</p>\n</blockquote>\n<p>修改 <code class=\"language-text\">kernel/fork.c</code> 文件中的 <code class=\"language-text\">copy_process()</code>，如下所示：</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">extern</span> <span class=\"token keyword\">void</span> <span class=\"token function\">first_return_kernel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">int</span> <span class=\"token function\">copy_process</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> nr<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> ebp<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> edi<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> esi<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> gs<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> none<span class=\"token punctuation\">,</span>\r\n        <span class=\"token keyword\">long</span> ebx<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> ecx<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> edx<span class=\"token punctuation\">,</span>\r\n        <span class=\"token keyword\">long</span> fs<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> es<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> ds<span class=\"token punctuation\">,</span>\r\n        <span class=\"token keyword\">long</span> eip<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> cs<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> eflags<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> esp<span class=\"token punctuation\">,</span><span class=\"token keyword\">long</span> ss<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">file</span> <span class=\"token operator\">*</span>f<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">/* add lab4 */</span>\r\n    <span class=\"token keyword\">long</span> <span class=\"token operator\">*</span>krnstack<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 1. 申请内存作为子进程的PCB</span>\r\n    p <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">task_struct</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token function\">get_free_page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    \r\n    <span class=\"token comment\">// 2. 关联子进程的用户栈和内核栈，就是将父进程内核栈前五个内容拷贝</span>\r\n    krnstack <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>PAGE_SIZE <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// p指针加上页面大小就是子进程的内核栈位置</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ss <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 往低地址方向扩展</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> esp<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> eflags<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> cs <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> eip<span class=\"token punctuation\">;</span>\r\n    \r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ds <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> es <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> fs <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> gs <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> esi<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> edi<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> edx<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 3. 设置ret地址代码。父线程执行switch_to到了最后一步，此时PCB的esp已经切换到了子线程，基地址是对的，只需设置相对地址，无需jmp</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span> first_return_kernel<span class=\"token punctuation\">;</span> \r\n    <span class=\"token comment\">// 4. 继续压栈，保护子线程现场</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ebp<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ecx<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ebx<span class=\"token punctuation\">;</span>\r\n    <span class=\"token comment\">// 这里的 0 最有意思。</span>\r\n    <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>krnstack<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 子进程内核栈中，fork后eax返回0</span>\r\n\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>p<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span>EAGAIN<span class=\"token punctuation\">;</span>\r\n    task<span class=\"token punctuation\">[</span>nr<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> p<span class=\"token punctuation\">;</span>\r\n    <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>current<span class=\"token punctuation\">;</span>    <span class=\"token comment\">/* NOTE! this doesn't copy the supervisor stack */</span>\r\n    p<span class=\"token operator\">-></span>state <span class=\"token operator\">=</span> TASK_UNINTERRUPTIBLE<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>pid <span class=\"token operator\">=</span> last_pid<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>father <span class=\"token operator\">=</span> current<span class=\"token operator\">-></span>pid<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>counter <span class=\"token operator\">=</span> p<span class=\"token operator\">-></span>priority<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>signal <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>alarm <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>leader <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">/* process leadership doesn't inherit */</span>\r\n    p<span class=\"token operator\">-></span>utime <span class=\"token operator\">=</span> p<span class=\"token operator\">-></span>stime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>cutime <span class=\"token operator\">=</span> p<span class=\"token operator\">-></span>cstime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>start_time <span class=\"token operator\">=</span> jiffies<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>back_link <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>esp0 <span class=\"token operator\">=</span> PAGE_SIZE <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span> p<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ss0 <span class=\"token operator\">=</span> <span class=\"token number\">0x10</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>eip <span class=\"token operator\">=</span> eip<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>eflags <span class=\"token operator\">=</span> eflags<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>eax <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ecx <span class=\"token operator\">=</span> ecx<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>edx <span class=\"token operator\">=</span> edx<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ebx <span class=\"token operator\">=</span> ebx<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>esp <span class=\"token operator\">=</span> esp<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ebp <span class=\"token operator\">=</span> ebp<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>esi <span class=\"token operator\">=</span> esi<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>edi <span class=\"token operator\">=</span> edi<span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>es <span class=\"token operator\">=</span> es <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>cs <span class=\"token operator\">=</span> cs <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ss <span class=\"token operator\">=</span> ss <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ds <span class=\"token operator\">=</span> ds <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>fs <span class=\"token operator\">=</span> fs <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>gs <span class=\"token operator\">=</span> gs <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>ldt <span class=\"token operator\">=</span> <span class=\"token function\">_LDT</span><span class=\"token punctuation\">(</span>nr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>trace_bitmap <span class=\"token operator\">=</span> <span class=\"token number\">0x80000000</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>last_task_used_math <span class=\"token operator\">==</span> current<span class=\"token punctuation\">)</span>\r\n        <span class=\"token function\">__asm__</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clts ; fnsave %0\"</span><span class=\"token operator\">::</span><span class=\"token string\">\"m\"</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">.</span>i387<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">copy_mem</span><span class=\"token punctuation\">(</span>nr<span class=\"token punctuation\">,</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        task<span class=\"token punctuation\">[</span>nr<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">free_page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span>EAGAIN<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>NR_OPEN<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>f<span class=\"token operator\">=</span>p<span class=\"token operator\">-></span>filp<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n            f<span class=\"token operator\">-></span>f_count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current<span class=\"token operator\">-></span>pwd<span class=\"token punctuation\">)</span>\r\n        current<span class=\"token operator\">-></span>pwd<span class=\"token operator\">-></span>i_count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current<span class=\"token operator\">-></span>root<span class=\"token punctuation\">)</span>\r\n        current<span class=\"token operator\">-></span>root<span class=\"token operator\">-></span>i_count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current<span class=\"token operator\">-></span>executable<span class=\"token punctuation\">)</span>\r\n        current<span class=\"token operator\">-></span>executable<span class=\"token operator\">-></span>i_count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">set_tss_desc</span><span class=\"token punctuation\">(</span>gdt<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>nr<span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>FIRST_TSS_ENTRY<span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>tss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">set_ldt_desc</span><span class=\"token punctuation\">(</span>gdt<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>nr<span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>FIRST_LDT_ENTRY<span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>ldt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    p<span class=\"token operator\">-></span>state <span class=\"token operator\">=</span> TASK_RUNNING<span class=\"token punctuation\">;</span>    <span class=\"token comment\">/* do this last, just in case */</span>\r\n    \r\n    <span class=\"token comment\">// 5. 设置结构体指针，把switch_to中要的东西存进去</span>\r\n    p<span class=\"token operator\">-></span>kernelstack <span class=\"token operator\">=</span> krnstack<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 第四段（将PCB与内核栈关联），上面只是得到内核栈位置并赋值，这边才实现关联</span>\r\n    \r\n    <span class=\"token keyword\">return</span> last_pid<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>需补充的内容：</p>\n<ol>\n<li>在 <code class=\"language-text\">kernel/system_call.s</code> 中添加 <code class=\"language-text\">first_return_kernel</code> 实现</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"asm\"><pre class=\"language-asm\"><code class=\"language-asm\">! system_call.s\r\n! 汇编语言中定义的方法可以被其他调用需要\r\n.globl switch_to\r\n.globl first_return_kernel\r\n! 硬编码改变 these are offsets into the task-struct\r\n\r\n! 修改了几个变量\r\nstate\t= 0\t\t# these are offsets into the task-struct.\r\ncounter\t= 4\r\npriority = 8\r\n\r\n# 在 task_struct(PCB) 添加了 kernelstack，所以要修改\r\nsignal    = 16\r\nsigaction = 20\r\nblocked = (33*16+4)\r\n\r\n.align 2\r\nfirst_return_kernel:\r\n    popl %edx\r\n    popl %edi\r\n    popl %esi\r\n    pop %gs\r\n    pop %fs\r\n    pop %es\r\n    pop %ds\r\n    iret</code></pre></div>\n<ol start=\"2\">\n<li>注释掉 <code class=\"language-text\">include/linux/sched.h</code> 文件中的 <code class=\"language-text\">switch_to</code> 实现</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*#define switch_to(n) {\\\r\nstruct {long a,b;} __tmp; \\\r\n__asm__(\"cmpl %%ecx,current\\n\\t\" \\\r\n    \"je 1f\\n\\t\" \\\r\n    \"movw %%dx,%1\\n\\t\" \\\r\n    \"xchgl %%ecx,current\\n\\t\" \\\r\n    \"ljmp *%0\\n\\t\" \\\r\n    \"cmpl %%ecx,last_task_used_math\\n\\t\" \\\r\n    \"jne 1f\\n\\t\" \\\r\n    \"clts\\n\" \\\r\n    \"1:\" \\\r\n    ::\"m\" (*&amp;__tmp.a),\"m\" (*&amp;__tmp.b), \\\r\n    \"d\" (_TSS(n)),\"c\" ((long) task[n])); \\\r\n}*/</span></code></pre></div>\n<p>最后，编译并运行，若可以成功启动，则实验成功。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> oslab_Lab4/linux-0.11\r\n<span class=\"token function\">make</span> all\r\n<span class=\"token punctuation\">..</span>/run</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 581px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/eedce6f1233a81bdfa6b73a5a82b53d4/92d15/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVR42pWTy04iURCGG2ho7jS00DQgGrygYW+IrbNxY+YStGFm6yOwIAFCuAhx6exm4xNwCZPME+hLmAEizKv8U3UMEzcIs/hSp0+f+vuvOtXSh7MzmPk88icnODdNfPn0GSXLQvHqGt+sIqxCAV8plq4tWFcFlIpFFOn9x8tLnFIeY1LexbmJm4tTSLd3d/jx8IDBeIznyQS/p1PMFgtMX+aYzeeYzGa0fsGU1vPFHzw9PqLf72M0GuG208H3+3sMh0MMBwP8+jmG5I/HET06gpHNQk+lBPG9Peg7OzAODhDPZGAcHiJxfIz47i4Cfj/8RCikwuv1IhAI0DokUMNhSMFcDu5kEgohRyJwahpcsZiINpcLkiT9Hx5y4tnehm9/X+Ald0uUaPT1kM32yiaCESpZpUQ/uQttbSGs69DIYYDsyx4PHA7HP+x2+3rBhGFAI7FkIoEYCaeodI78HCFRnT5g0BnuEYuuFQwGg/D5fAJutodccTI3m9+pqiqi0+kU+2H6yLvCfIATGI0uQlEUyLIskpZxWS6LMrb3+slXzc7YydrDm5BOp5GkvjHskMU36tUqcjSHWRrqFA10hoaYn2N8y9RDdr3sJZf89sZXIfG0u2iA3W63KJnXG43HKnq9Hjr0T9brdZTLZVQqFTSbTVSrVdRqNTQaDRFbrRa63a44+zbyfrvdFvDeX2n8h32nqLRRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/eedce6f1233a81bdfa6b73a5a82b53d4/92d15/1.png\"\n        srcset=\"/blog/static/eedce6f1233a81bdfa6b73a5a82b53d4/c26ae/1.png 158w,\n/blog/static/eedce6f1233a81bdfa6b73a5a82b53d4/6bdcf/1.png 315w,\n/blog/static/eedce6f1233a81bdfa6b73a5a82b53d4/92d15/1.png 581w\"\n        sizes=\"(max-width: 581px) 100vw, 581px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>总结</strong>：</p>\n<blockquote>\n<p>本次实验归根结底还是完成了李老师所述的五段论：\r\n（fork：<code class=\"language-text\">int 0x80</code> -> <code class=\"language-text\">system_call</code> -> <code class=\"language-text\">sys_call_table</code> -> <code class=\"language-text\">sys_fork</code> -> <code class=\"language-text\">find_empty_process</code> -> <code class=\"language-text\">copy_process</code> -> <code class=\"language-text\">system_call(rescjedule)</code>-> <code class=\"language-text\">schedule</code> -> <code class=\"language-text\">switch_to</code>）</p>\n</blockquote>\n<ol>\n<li>用户栈->内核栈：调用<code class=\"language-text\">fork</code>时会执行<code class=\"language-text\">0x80</code>中断，进而进入内核态。进入前，CPU会将SS、ESP、EFLAGS、CS、EIP压入内核栈，进而父进程内核栈和用户栈取得联系。(<code class=\"language-text\">system_call</code>将DS、ES、FS....压入栈)</li>\n<li>内核栈->PCB：在PCB的结构体中添加了内核栈指针。</li>\n<li>PCB完成切换：通过 <code class=\"language-text\">Schedule</code> 中的 <code class=\"language-text\">switch_to</code> 传入下个进程</li>\n<li>PCB->内核栈：<code class=\"language-text\">copy_process</code> 中获取内核栈位置，并在PCB中内核栈指针赋值</li>\n<li>内核栈->用户栈：为内核栈指针进行赋值填入用户态SS:ESP，并设置包含<code class=\"language-text\">iret</code>的返回函数</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 577px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/8ecbc10421d5e07c320d15a9c7da69b0/065e2/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDklEQVR42lWT63LiVhCEef+32F/ZTVUSEntju7zGXmOutmMj7iB0l5BAIC4CDBJ8O2BvKqFKdYROn5nunj4ZpfaCUmugawMGgzqeNyAIdMYjE0NvoWkd4njEcunL/wG11zrtdpuB1jhhfF9jJKvaV4gil0y/Z6OqoXyMcV1PDq/Z7RKSZC/fQhTF5OdvFCzodEfo+gTPHQou5e1tJ9gUx/FkTchEUfTvAdfQpaiDIavj2HhDT9gPTnuHw+EDdSDZbnBt2ffcD6yDZZnSYCcFp9MTbNdt4b88E4QTod8XqRqz+QKl8MK6XWfVbrDWVFZqlyh3hffHF8xOC9t1hbFOGIbvBWeLJYfFjF1LwbQs8S9gNpsxn88xTZOaYpwapquYdL0iCUfEUnwgzY/qJkIoimbiv0qaHiULi0Rk7myTYDI5dfkp71hUqZv/k5xYOtvphPDDqjTdn1Z14PJ0VnyXnAYeqS9+iC+G0HfFE1ek9Hp9GYr+UVAeMT1xLRJhO9A1An+IbTkUK20ebsp0vpyRaTWbTE2DvQCPkp+e/6EpsSiUSpTKFZpN+1RwK8VswS1ti/1iLh6rFPJlri5KXH+7p3F9jt9UySilApHo3/Q7qNUyTq/LVMATQ0NttVCe2rCcs/Q9TNmb9zoyJIXao0K1ILkVphPXRv+axWrpZJ4qwuIuRzoNcR/LWDK5aqVM+e4Wt9/l7q5F/FgivMhSE9auHPaUDs/ZazxhfF8solQr+IKxhksy/mjEJpqyFwZWu4krDCy1j6Oq2N029fNvjP25TGMrIV4z9CLUuoH58J1Ahml5HkNhbha+YwerY2wWICYnjsVwPGYj77vN5hSBSMK9aLxi+hvmyy2L9R69ZbMeBQyHQ1KZVLKXRyY+ei5T745lypI59nsS20Br1NGkm2MYWI4E9pdPLEX2wTGpnJfFmhf2Rp+48kC//p5bQ7Jqi5puuUi8+e/Ve9vQlaFc/pmlevk3+atL8tnfmcrVSnIXxGe/sZLbsf7rV+LPn3i9+MrVzQ23uRy521vu8/nTTfkBgyP97eXoD5MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/8ecbc10421d5e07c320d15a9c7da69b0/065e2/2.png\"\n        srcset=\"/blog/static/8ecbc10421d5e07c320d15a9c7da69b0/c26ae/2.png 158w,\n/blog/static/8ecbc10421d5e07c320d15a9c7da69b0/6bdcf/2.png 315w,\n/blog/static/8ecbc10421d5e07c320d15a9c7da69b0/065e2/2.png 577w\"\n        sizes=\"(max-width: 577px) 100vw, 577px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"【哈工大_操作系统实验】Lab5 基于内核栈切换的进程切换","date":"October 01, 2024","description":"本文将介绍哈工大操作系统实验课Lab5 基于内核栈切换的进程切换"}},"previous":{"fields":{"slug":"/013_HIT_OS_Lab4/"},"frontmatter":{"title":"【哈工大_操作系统实验】Lab4 进程运行轨迹的跟踪与统计"}},"next":{"fields":{"slug":"/015_HIT_OS_Lab6/"},"frontmatter":{"title":"【哈工大_操作系统实验】Lab6 信号量的实现和应用"}}},"pageContext":{"id":"bf47b7f4-595d-501d-b207-be0c83d803f8","previousPostId":"9480e2bf-816c-5fce-838a-d47165641f14","nextPostId":"a3234939-ea6b-51d3-b87c-5b00bf1a98cc"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}