{"componentChunkName":"component---src-templates-blog-post-js","path":"/004_Lanqiaobei/","result":{"data":{"site":{"siteMetadata":{"title":"JokerDebug"}},"markdownRemark":{"id":"68e3f69d-40e6-537f-bec1-c4055d9906d3","excerpt":"Github代码仓库链接 一、前言 承接上文，本文将继续介绍剩余蓝桥杯涉及模块（PCF8591、AT24C02、PWM、串口通信、NE555以及超声波测距），为大家做出详细编程指导。 二、PCF8591 A/D 转换模块 笔者将基于蓝桥杯官方给的赛点资源包（蓝桥杯单片机设计与开发…","html":"<p><a href=\"https://github.com/Joker001014/LanQiaoCup\">Github代码仓库链接</a></p>\n<h2>一、前言</h2>\n<p>承接上文，本文将继续介绍剩余蓝桥杯涉及模块（PCF8591、AT24C02、PWM、串口通信、NE555以及超声波测距），为大家做出详细编程指导。</p>\n<h2>二、PCF8591 A/D 转换模块</h2>\n<p>笔者将基于蓝桥杯官方给的赛点资源包（<a href=\"https://github.com/Joker001014/LanQiaoCup/tree/main/%E8%B5%9B%E7%82%B9%E8%B5%84%E6%BA%90%E6%95%B0%E6%8D%AE%E5%8C%85_SCM\">蓝桥杯单片机设计与开发_赛点资源数据包</a>）进行编程，为大家讲解编程调用各语句的含义，帮助大家编写温度传感器的程序，也便于大家记忆。</p>\n<h3>1、导入底层驱动代码</h3>\n<p>读者可下载赛点资源包，解压后可得到以下图片所示文件。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/93f78654fba2229b6f46f4f17b49c028/828fb/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2kUKMf/EABgQAAIDAAAAAAAAAAAAAAAAAAABAhAx/9oACAEBAAEFAk7joz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAQAGPwJr/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERMRBRIXGR/9oACAEBAAE/IeRpwKVqzzE32XP/2gAMAwEAAgADAAAAEDTP/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QV//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAEUGxITGRwf/aAAgBAQABPxBEWt0AdxWUEi0z7nO/DPhuaZ//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/93f78654fba2229b6f46f4f17b49c028/828fb/1.jpg\"\n        srcset=\"/blog/static/93f78654fba2229b6f46f4f17b49c028/ff44c/1.jpg 158w,\n/blog/static/93f78654fba2229b6f46f4f17b49c028/a6688/1.jpg 315w,\n/blog/static/93f78654fba2229b6f46f4f17b49c028/828fb/1.jpg 630w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n我们双击打开文件“3-底层驱动代码参考”文件，将得到以下 <code class=\"language-text\">.c</code> 和 <code class=\"language-text\">.h</code> 文件。接下来将 <code class=\"language-text\">iic.c</code> 和 <code class=\"language-text\">iic.h</code> 文件拷贝到工程所在文件夹中，并在编译器中将这两个文件导入，便可以开始编写程序了。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 609px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/fb0349c4673318b7150afa79026c7922/d0d8c/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.556962025316455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqElEQVR42lWN2wqCUBBF/X/6jfqAIMg/SOliUPSkp6K8HNH0eCHQXE32UgObmVmzh22pi0+qNWMNw7+kKmPIsoxHntM2zchMWdLI3HUdfd+L9eu17SWWOh0wYQQfc13/S1hxv5MEAelZUcUxtK2wG0UYYqKIp4T1EvCqDIvZFEtv13C98vJ9Bnn8FUpR7j2065Jt1rTH48gKb0fiOMSr1Xj/7IX0+WTCG2iZ38/LLvjxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"![[Pasted image 20231020210509.png]]\"\n        title=\"\"\n        src=\"/blog/static/fb0349c4673318b7150afa79026c7922/d0d8c/2.png\"\n        srcset=\"/blog/static/fb0349c4673318b7150afa79026c7922/c26ae/2.png 158w,\n/blog/static/fb0349c4673318b7150afa79026c7922/6bdcf/2.png 315w,\n/blog/static/fb0349c4673318b7150afa79026c7922/d0d8c/2.png 609w\"\n        sizes=\"(max-width: 609px) 100vw, 609px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>2、PCF8591 A/D转换函数封装</h3>\n<p>首先，在编写驱动函数之前，我们需要在底层驱动代码 <code class=\"language-text\">iic.c </code>文件中编写 <strong>A/D转换函数</strong>，即 模拟量转化为数字量 和 数字量转化为模拟量。我们可以打开赛点资源数据包中的文件“5-竞赛板芯片资料”。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e5f3caa93863fbe80e44f65abed177c5/f7974/3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAezc2aD/xAAYEAACAwAAAAAAAAAAAAAAAAACEBEhMv/aAAgBAQABBQKbQ6X/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAbEAACAwADAAAAAAAAAAAAAAAAARExUSFxof/aAAgBAQABPyFPJRwS8JeelhvY7P/aAAwDAQACAAMAAAAQpB//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCq/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQEAAgMAAAAAAAAAAAAAAREAEFFhobH/2gAIAQEAAT8QKwsECYGwhe94memZ+HB//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/e5f3caa93863fbe80e44f65abed177c5/828fb/3.jpg\"\n        srcset=\"/blog/static/e5f3caa93863fbe80e44f65abed177c5/ff44c/3.jpg 158w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/a6688/3.jpg 315w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/828fb/3.jpg 630w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/0ede0/3.jpg 945w,\n/blog/static/e5f3caa93863fbe80e44f65abed177c5/f7974/3.jpg 1097w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>打开“PCF8591”芯片手册。笔者将借助芯片手册中的资料编写温度读取函数并为大家讲解。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 621px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/2e6b96d4b405584b91f373fac9253b19/3075e/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42nVS2W7CMBDM/38VPwBUKmoBQbgTcjiHiXMAyXTWqREP7UqjJJv1emdmvToIEIUhQqKqKkgMwwAX9/sdRVFYVGb8X9c1v3Pkef6qvd1u6LoWntntsF2vsdvtkfOQC1fYti2i6Io4jtlg/K/LkrnIou97m1NpCmMMvPpywfl0QpZl+CtkQplEJmyaxuaEidQL3MX6pu3lXn06YrNe4cimf0XXdUiSBBmbCi13OGVO8tJQkKoUNS/06uMB/maDiJT+a6iUsnSFktMrJcWEcBPKtI1teD5jTx2r3+J3QxxllSkie5km5kgD9UZZGDStNNz7WH1/QeuRziAiS9FvYUddEoqfxBFKMY1pzWd0pVHMS71AkX5jTZlMcCCKjw/Qagzb7QvwfXTLJbLpFMV8DrNY2Jz5/LS5bDZFT7kG5orZDA298MxqiTULDj4b9Lz+8RCeI/jeUq+Im5BwTzW1xPOJktpdaWJI9NRYamPus+HknmFhEFxwIU48KCa8a2nXpnSLPeos4oshwTW0zopZcrbUGj9Kaf3S7nTZAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"![[Pasted image 20231020210729.png]]\"\n        title=\"\"\n        src=\"/blog/static/2e6b96d4b405584b91f373fac9253b19/3075e/4.png\"\n        srcset=\"/blog/static/2e6b96d4b405584b91f373fac9253b19/c26ae/4.png 158w,\n/blog/static/2e6b96d4b405584b91f373fac9253b19/6bdcf/4.png 315w,\n/blog/static/2e6b96d4b405584b91f373fac9253b19/3075e/4.png 621w\"\n        sizes=\"(max-width: 621px) 100vw, 621px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>模拟量转化成数字量：编写AD转换函数，具体每条代码的含义都已经注释，在这里将不再赘述。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 模拟量转化成数字量</span>\r\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token function\">PCF8591_ADC</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> addr<span class=\"token punctuation\">)</span>     \r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> date<span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token function\">IIC_Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">//开启总线</span>\r\n\t<span class=\"token function\">IIC_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//0x90: 1001 0000  向PCF8091写数据</span>\r\n\t<span class=\"token function\">IIC_WaitAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//等待应答</span>\r\n\t<span class=\"token function\">IIC_SendByte</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//写数据</span>\r\n\t<span class=\"token function\">IIC_WaitAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//等待应答</span>\r\n\t<span class=\"token function\">IIC_Stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//关闭总线</span>\r\n\t\r\n\t<span class=\"token function\">IIC_Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">//开启总线</span>\r\n\t<span class=\"token function\">IIC_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x91</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//0x91: 1001 0001  向PCF8091读数据</span>\r\n\t<span class=\"token function\">IIC_WaitAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//等待应答</span>\r\n\tdate <span class=\"token operator\">=</span> <span class=\"token function\">IIC_RecByte</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">//接受数据</span>\r\n\t<span class=\"token function\">IIC_SendAck</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//发送fei应答：已经读完数据</span>\r\n\t<span class=\"token function\">IIC_Stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//关闭总线</span>\r\n\t\r\n\t<span class=\"token keyword\">return</span> date<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>其中，在编写模数转换函数指令可通过查阅芯片资料手册，不需要死记硬背。</p>\n<ul>\n<li>PCF8591芯片地址前四位默认为 <code class=\"language-text\">1001</code> 即 <code class=\"language-text\">9</code></li>\n<li>后四位 <code class=\"language-text\">A2\\A1\\A0</code> 视具体的接线而定，最低位为 <code class=\"language-text\">0</code> 则表示向芯片写数据，为 <code class=\"language-text\">1</code> 则表示从芯片读数据。</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/f01647a751c5082b12e81e4e44471340/5c6e9/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVR42q1SaXOCQAzl//84KwpqB0Qrt4Cci4rHa946MrXj9FMzE7JLsi8vh4F/FoOfNElg2TYul6voBcMwjPap1+vDp/+L8n673dC2Ddz1+hUwjmOEYYggCJDnOXzfR1E87OFw0Ha/32O32yHLMkRRJLE+Innnui4cx9GJRkA+6roOsQSmaarBCUDbNI1OuN1u4XkbfU6kos/VCoH4p+YUa2HIKkbAoihGoLIs9QNa3smIzKqqQipJaLMsFxKlTlpJXCtJ2YIRkJfzeYBSHWzbgm3NYS+WmjVLYRtM04Ql/2czE5PJBxYLGxthTbnf7689fAodp9MJfa/QH49jIMtpBVwpJYnP2h7Fz3awFYlU94w1/loBBv1W/GDDyuq6lkrUe4b/toevrB42lBXiVEvZgI3nYbVc4kuGE4YRPJlqLoPkHrLHbBOVjI13ZVKSJMXcslA39QjoOK5M3NcD4m6yj33f6y3hNvD8DfwiTekwrcliAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"![[Pasted image 20231020210919.png]]\"\n        title=\"\"\n        src=\"/blog/static/f01647a751c5082b12e81e4e44471340/5c6e9/5.png\"\n        srcset=\"/blog/static/f01647a751c5082b12e81e4e44471340/c26ae/5.png 158w,\n/blog/static/f01647a751c5082b12e81e4e44471340/6bdcf/5.png 315w,\n/blog/static/f01647a751c5082b12e81e4e44471340/5c6e9/5.png 492w\"\n        sizes=\"(max-width: 492px) 100vw, 492px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>数字量转化成模拟量：编写DA转换函数。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 数字量转化成模拟量</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">PCF8591_DAC</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> date<span class=\"token punctuation\">)</span>     \r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token function\">IIC_Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">//开启总线</span>\r\n\t<span class=\"token function\">IIC_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//0x90: 1001 0000  向PCF8091写数据</span>\r\n\t<span class=\"token function\">IIC_WaitAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//等待应答</span>\r\n\t<span class=\"token function\">IIC_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//告诉芯片要输出模拟量，即DA</span>\r\n\t<span class=\"token function\">IIC_WaitAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//等待应答</span>\r\n\t<span class=\"token function\">IIC_SendByte</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//</span>\r\n\t<span class=\"token function\">IIC_WaitAck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//等待应答</span>\r\n\t<span class=\"token function\">IIC_Stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//关闭总线</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>同样可以查阅上述芯片资料手册，第六位为 <code class=\"language-text\">1</code> 时即表示输出模拟量，以及其他位的含义在芯片中都可以查找到，在这里还是想强调一下：<strong>初学者一定要学会看芯片手册，学会看手册对于你的代码水平一定会有提升</strong>。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 367px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/9931dc242a62fda42643cc5ce10ec19f/46684/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 186.70886075949366%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD5ElEQVR42p1Wi5aaShDc//+ge5MfyN4ka9bdVVfxDSgveaMgop2qIex1HzmBcA5nnAFrurqra7gRXJZlyW7ny/F4lMPhIHmef3jzeRj64vk7qa+LvL1uzuezGIYus8VSttutbDYbtYHruqLrupimebXmyQbzLX5HcSSe52GDUIIgEOIowMvlIlmWie/74jjOK6DdbqfWbdvGb09Mw1TraZoqMG7keTv1+3DIpTyWcqMCv9Shx3GsduKuSZK80OA63+EaI2UA9aaG9PsPsgC76XQqq9W6Bnz7x/1+L0VRvFtvrjw/qPQEyGWv15PVeo1A6ud/BViVhbigatuWfPr8WZ7H4/aAnDPpp9NJrTd5NnRDlsulzGYzFNX4vyhtIjyWpZqfMAaBL6PRCEBz8SC14lionDYEfgvIwpQAcBz7lWxYUW0yVjLTkTvq95UO3wIydN6Mar/PFC1SGo2G0n94wDiQ4XAoj4+P2GgrSZq90H0HSFlcP2wKsd2Y0vtxjwgdBU4tssqUze1/t6JBMpcugLa1lafB6CUVURipd7nRl9svMkVhWgE29ENUuS6Cp7qGlWYufehQ0zSxMW8FWJtBqCIjPdJdLlcyX8yVdKqrd1vlsLnSJBYTBbjgGSNco7olNqOMKJlrif0RkHlUVQcARxaDgBwjRD+fz9Umly4RskvK8qR0uVgsYAKrV0XrTDmG9znIGZ83umQ77kGXgo+Rkk6A15E2XtkA2uikFGMnQOaPySdl5qyh/NHVStj0PcqF7j2GVRmIcgNRc30y0cRCUTpFeDjslQmQMnNmwiyqqlIbcqza9vL5XKlTsCyPSHyCXKXKQNg5HCPcKdbzvKUOq1OpQNjL3+/uVEGYv7W+VsZKU+j1visra47VVjl00avP4wkKkypBUzY8+VzHUpZmIp+d3CaJ69ZjizHKOYwijEKVWw9HbWfZRFGEdtOVfOjebD3qsIk4hJ21lg0ry0oyOt6kyg0+ars/F6WqT7oErUVBMzKa6RCHFKvcGfC6lxvKLAgNgj5JytRlgN+d3IYROo6rAAlA0MZ46d5MQacIc4ibiWcuWRQ6Tmf7ulx9/VEW7NcTACkTHRFyzvdX6xUoB78B/HUu/9pems+BDOuWif4FZYfCRrcU/LpgwUC9AIMPAdmbJ3ypFvf3EuFOcJing4Ek6IZsOJAU85DrmJ9QbVQKn79wGhz8EkfvAfcAy0ApQ48aOCafJhPRKBXQmoHmE6xLwzfgBs8C0K3AwMd/dtpUEjJ4C6iYgpY8P0sJIBfRuP2+BIjSuuvJ5ts3sX/0JAZwpqG3seH661dZ/POvWAAtz2f5CbiEIva0wqrfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"![[Pasted image 20231020211515.png]]\"\n        title=\"\"\n        src=\"/blog/static/9931dc242a62fda42643cc5ce10ec19f/46684/6.png\"\n        srcset=\"/blog/static/9931dc242a62fda42643cc5ce10ec19f/c26ae/6.png 158w,\n/blog/static/9931dc242a62fda42643cc5ce10ec19f/6bdcf/6.png 315w,\n/blog/static/9931dc242a62fda42643cc5ce10ec19f/46684/6.png 367w\"\n        sizes=\"(max-width: 367px) 100vw, 367px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>在编写完时间读写函数后务必要在 <code class=\"language-text\">iic.h</code> 文件中声明函数，才可在主函数中调用。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">_IIC_H</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_IIC_H</span></span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"intrins.h\"</span></span>\r\n\r\nsbit SDA <span class=\"token operator\">=</span> P2<span class=\"token operator\">^</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* 数据线 */</span>\r\nsbit SCL <span class=\"token operator\">=</span> P2<span class=\"token operator\">^</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* 时钟线 */</span>\r\n\r\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token function\">PCF8591_ADC</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">PCF8591_DAC</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<h3>3、主函数调用</h3>\n<p>在主函数中调用时间模块底层函数，首先需要在主函数开头包含驱动 <code class=\"language-text\">iic.h</code> 头文件。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"iic.h\"</span></span></code></pre></div>\n<p>main主函数\r\n主程序调用比较简单，下文中实现了 <strong>采用PCF8591 D/A模块输出电压，并通过按键修改输出电压值；并通过PCF8591 A/D模块Rb2电压和A/D脚电压，并通过数码管显示</strong>。由于考虑初学者基础较为薄弱，因此将完整的 main.cpp 代码贴出来，包含中断函数、矩阵键盘、数码管显示等，并且在关键处进行了注释，希望对大家有所帮助。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 包含头文件</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"iic.h\"</span></span>\r\n\r\n<span class=\"token comment\">// 数据类型定义</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u8</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u16</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span></span></span>\r\n\r\n<span class=\"token comment\">// 8位数码管状态</span>\r\nu8 dspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \r\nu8 code tab<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x24</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x19</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x89</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xc1</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xbf</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\t             <span class=\"token comment\">//  0 ,  1 ,  2 ,  3 ,  4 ,  5 ,  6 ,  7 ,  8 ,  9 , 灭 , 0. , 1. , 2. , 3. , 4. , 5. , 6. , 7. , 8. , 9. ,  H ,  U ,  -  ; </span>\r\n\t             <span class=\"token comment\">//  0 ,  1 ,  2 ,  3 ,  4 ,  5 ,  6 ,  7 ,  8 ,  9 , 10 , 11 , 12 , 13 , 14 , 15 , 16 , 17 , 18 , 19 , 20 , 21 , 22 , 23  ;</span>\r\nu8 dspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">;</span>\r\nbit key_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>iic_flag1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>iic_flag2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// 定时器初始化</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">//2毫秒@12.000MHz</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tAUXR <span class=\"token operator\">|=</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器时钟1T模式</span>\r\n\tTMOD <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0xF0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时器模式</span>\r\n\tTL0 <span class=\"token operator\">=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTH0 <span class=\"token operator\">=</span> <span class=\"token number\">0xA2</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//清除TF0标志</span>\r\n\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器0开始计时</span>\r\n\t\r\n\tET0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//开定时中断</span>\r\n\tEA<span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t\t<span class=\"token comment\">//开总中断</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 573锁存器封装成函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">door</span><span class=\"token punctuation\">(</span>u8 choose<span class=\"token punctuation\">,</span>u8 input<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tP2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P2 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> choose<span class=\"token punctuation\">;</span>\r\n\tP0 <span class=\"token operator\">=</span> input<span class=\"token punctuation\">;</span>\r\n\tP2 <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">;</span>\t\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 关数码管</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 关灯、蜂鸣器、数码管</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t     \r\n<span class=\"token punctuation\">{</span>\r\n \t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 数码管显示函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\t\t\t  \r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//消隐</span>\r\n\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x01</span><span class=\"token operator\">&lt;&lt;</span>dspcom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span>tab<span class=\"token punctuation\">[</span>dspbuf<span class=\"token punctuation\">[</span>dspcom<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>dspcom <span class=\"token operator\">>=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>     <span class=\"token comment\">//or dspcom &amp;= 0x07;</span>\r\n\t\tdspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 矩阵键盘，接KBD</span>\r\nu8 keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span>keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\nu8 <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t                             \r\n<span class=\"token punctuation\">{</span>\r\n    u8 key_m<span class=\"token punctuation\">,</span>cal<span class=\"token punctuation\">;</span>\r\n    \r\n    P3 <span class=\"token operator\">=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">;</span>P42<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>P44<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n  \tP36<span class=\"token operator\">=</span>P42<span class=\"token punctuation\">;</span>P37<span class=\"token operator\">=</span>P44<span class=\"token punctuation\">;</span>\t\t\t   <span class=\"token comment\">//变量替换</span>\r\n    key_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">!=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">)</span> \r\n        keypress<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n   <span class=\"token keyword\">else</span>\r\n        keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> \r\n    \r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>keypress <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n\t\t  keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t  \tkeyread <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t\t  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0x70</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>                \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xb0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xd0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n            <span class=\"token keyword\">case</span> <span class=\"token number\">0xe0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        \r\n        P3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tP36<span class=\"token operator\">=</span>P42<span class=\"token punctuation\">;</span>P37<span class=\"token operator\">=</span>P44<span class=\"token punctuation\">;</span>\t\t\t   <span class=\"token comment\">//变量替换</span>\r\n        key_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P3 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        \r\n\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n\t\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0e</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>                \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0d</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0b</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    \r\n\t\t\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x07</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    P3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tP36<span class=\"token operator\">=</span>P42<span class=\"token punctuation\">;</span>P37<span class=\"token operator\">=</span>P44<span class=\"token punctuation\">;</span>\t\t\t                <span class=\"token comment\">//变量替换</span>\r\n    key_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>keyread <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">==</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> keyvalue<span class=\"token punctuation\">;</span>\t\r\n    <span class=\"token punctuation\">}</span>\r\n    \r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span>  \r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">//````````````````````````````````主函数````````````````````````````````````</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t\t\r\n<span class=\"token punctuation\">{</span>\r\n\tu8 key_re<span class=\"token punctuation\">,</span>iic_w <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>vol <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token keyword\">int</span> date_1<span class=\"token punctuation\">,</span>date_2<span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token comment\">// 数字量转为模拟量，此时可以在单片机D/A角上测到 200/255*5V 电压</span>\r\n\t<span class=\"token function\">PCF8591_DAC</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n \t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_flag<span class=\"token punctuation\">)</span>\t\t\t\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\tkey_re <span class=\"token operator\">=</span> <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_re <span class=\"token operator\">!=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span>\r\n\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_re<span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t<span class=\"token comment\">// 修改电压输出</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">18</span><span class=\"token operator\">:</span>vol <span class=\"token operator\">+=</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span>iic_w <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span>iic_w <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t        <span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">default</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\t\t<span class=\"token comment\">// 设置修改的电压输出值</span>\r\n\t\t\t\t<span class=\"token function\">PCF8591_DAC</span><span class=\"token punctuation\">(</span>vol<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\t<span class=\"token comment\">// 定时采集Rb2电压大小</span>\r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>iic_flag1<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>iic_w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\tiic_flag1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tdate_1 <span class=\"token operator\">=</span> <span class=\"token function\">PCF8591_ADC</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//测Rb2电压</span>\r\n\t\t\t\tdate_1 <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token operator\">*</span>date_1<span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token operator\">*</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> date_1<span class=\"token operator\">/</span><span class=\"token number\">100</span><span class=\"token operator\">+</span><span class=\"token number\">11</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> date_1<span class=\"token operator\">%</span><span class=\"token number\">100</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> date_1<span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> \r\n\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\t<span class=\"token comment\">// 定时采集 A/D 引脚电压大小</span>\r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>iic_flag2<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>iic_w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\tiic_flag2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tdate_2 <span class=\"token operator\">=</span> <span class=\"token function\">PCF8591_ADC</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 用A/D引脚测电压</span>\r\n\t\t\t\tdate_2 <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token operator\">*</span>date_2<span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token operator\">*</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\r\n\t\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> date_2<span class=\"token operator\">/</span><span class=\"token number\">100</span><span class=\"token operator\">+</span><span class=\"token number\">11</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> date_2<span class=\"token operator\">%</span><span class=\"token number\">100</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> date_2<span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 定时器0中断服务函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">timer0</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> interrupt <span class=\"token number\">1</span>\t  \r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">static</span> u8  t_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>t_100ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//MAX = 500 ms</span>\r\n\r\n\t<span class=\"token comment\">//不需要重载装载值</span>\r\n\t\r\n\t<span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//数码管显示函数放里面</span>\r\n\r\n\tt_20ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\tt_100ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_20ms <span class=\"token operator\">>=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">//每20ms扫描一次按键</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_100ms <span class=\"token operator\">==</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>      \r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tiic_flag1 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_100ms <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_100ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tiic_flag2 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>至此，本次 PCF8591 A/D转换模块已介绍完毕。</p>","frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_PCF8591","date":"May 18, 2021","description":"本文介绍了蓝桥杯单片机编程大赛PCF8591 A/D转换模块的编程使用方法。"}},"previous":{"fields":{"slug":"/003_Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_DS1302"}},"next":{"fields":{"slug":"/005_Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_AT24C02"}}},"pageContext":{"id":"68e3f69d-40e6-537f-bec1-c4055d9906d3","previousPostId":"2d55a82e-76b3-5147-8714-07b2792df7d8","nextPostId":"a68b5677-7031-5f4b-add3-7b55a88389ba"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}