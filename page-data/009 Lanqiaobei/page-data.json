{"componentChunkName":"component---src-templates-blog-post-js","path":"/009 Lanqiaobei/","result":{"data":{"site":{"siteMetadata":{"title":"JokerDebug"}},"markdownRemark":{"id":"a94ec4cc-c5e8-5490-9ddc-bfe822a34fff","excerpt":"Github代码仓库链接 一、前言 承接上文，本文将介绍最后一个蓝桥杯模块（超声波测距），为大家做出详细编程指导。 二、超声波测距 超声波指的是频率超过人类可听范围（20千赫兹）的声波。超声波的产生和接收主要依靠超声波传感器，其通常由一个发射器和一个接收器组成。\r\n通过  可计算得到测距值。…","html":"<p><a href=\"https://github.com/Joker001014/LanQiaoCup\">Github代码仓库链接</a></p>\n<h2>一、前言</h2>\n<p>承接上文，本文将介绍最后一个蓝桥杯模块（超声波测距），为大家做出详细编程指导。</p>\n<h2>二、超声波测距</h2>\n<p>超声波指的是频率超过人类可听范围（20千赫兹）的声波。超声波的产生和接收主要依靠超声波传感器，其通常由一个发射器和一个接收器组成。\r\n通过 <code class=\"language-text\">距离 = 声速 × 时间 / 2</code> 可计算得到测距值。</p>\n<h3>1、超声波原理剖析</h3>\n<p>超声波的距离计算原理为：超声波发射和接收所需时间乘以声速即为距离（声速为 340m/s）</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> distance = t*0.000001(1us)*340/2(往返)*100(换算成厘米) = t * 0.017</code></pre></div>\n<h3>2、核心代码</h3>\n<p><strong>超声波计时初始化函数</strong> 可借助 STC-ISP 软件生成，选择 <code class=\"language-text\">定时器计算器</code>，配置好所需参数，如 定时器0 、 定时器时钟12T，即可自动生成串口初始化程序。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/121f3b865070969a5dcc2ce7a41c1285/73fd0/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.51898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACt0lEQVR42lVTa2/aQBD0//8ZUZUPlZJWitS0FaSJAQHBhJcxxg+MeRmMjQ2pUimApztXITWWRmft3c3O7s5pUbhEtI4QhjO4rofVKsJ6vcEsDDGfz+V/jdlshiiKsFgsMJU4sVqtVHy32yHPc6Rpiny/h2YOh9D1CpqtFrzJBI7rY2iNYLQNdLtddcmQPXs0giNnPVknnod+uw3j/h6dhwc4jSaceh3zfh9as9nEYDCAJ4eogKvruhjJxVCUxEmCFyFeyt6q9QynXEIiZxpC0L27w6+rK5jf7zHXdWw6HWgkYzmWZSlFabqDPwnw+PiIvmRcOx6cTg+20cF0OMLrOsbCdlH/UcLgZxmuXkPU7iCZSesmU2jsExWZpgnf9zG2R3hpNVQCX3q6ny+xlx5Zsr+RxPwY/3r7Ba3nZ5yOR0gTUUh8mx2g2baNcrmsFNUqOu7KVXzWTWn6EnMZ1GsUI80yuFLm29ubIhzJnatPn2BKUn5FthPCAttdDs1xHEVGWNJ0UwZiuRPVhkBKz6YzFKLgJMDhAMgkjzLRP9st3oWI6mTUijghYRAEqFarChxEso3FMlNMZOKhTDg7/AbrOR1PKM5nnE9ntRZFoWLH9yOOXCUWpxk0XiyVSmg0GhiKwul0KiL2IuagPBYuVuiaFgLpZWcwhOMHGIzGGNqO9Gz/D6IsTnNskh00ErCHdbFBrVYDe0rT0qxEIAl931NrKGe3cYzlciFYiiOSjxCLadwg2dPTk1p7vZ5SSecncoAxVvBNTEzPsqI836sqsiz/AFaksfm0DE1MXMzdktcRixpdDHt9fY2bmxvc3t6iUqkodZcK/oci5CCojqQkoZnpQSojMX1KfxJMzkuZ2IgVXMDYpSKNJXLCtA1La8sbZWkk5jtmT/lPe/EsB2cYhnoMBOPEeDxWe38BDwvtIhbu+lcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"![[Pasted image 20231125221334.png]]\"\n        title=\"\"\n        src=\"/blog/static/121f3b865070969a5dcc2ce7a41c1285/f058b/1.png\"\n        srcset=\"/blog/static/121f3b865070969a5dcc2ce7a41c1285/c26ae/1.png 158w,\n/blog/static/121f3b865070969a5dcc2ce7a41c1285/6bdcf/1.png 315w,\n/blog/static/121f3b865070969a5dcc2ce7a41c1285/f058b/1.png 630w,\n/blog/static/121f3b865070969a5dcc2ce7a41c1285/73fd0/1.png 793w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">//定时器0、12T时钟，用于超声波测距</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 12us@12.000MHz    频率：40KHZ,1/40000 = 25us，其中高电平12.5us，低电平12.5us，约12us</span>\r\n<span class=\"token punctuation\">{</span> \r\n\tAUXR <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x7F</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 定时器时钟12T模式 △</span>\r\n\tTMOD <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0xF0</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 设置定时器模式</span>\r\n\tTL0 <span class=\"token operator\">=</span> <span class=\"token number\">0xF4</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 设置定时初值</span>\r\n\tTH0 <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 设置定时初值</span>\r\n\tTF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 清除TF0溢出标志位</span>\r\n\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 关闭定时器0  △</span>\r\n<span class=\"token punctuation\">}</span> </code></pre></div>\n<p><strong>超声波接收函数</strong> 具体代码功能均已注释，在此不再赘述。</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">// 超声波接收函数\r\nu8 Wave_recv(void) \r\n{\r\n\t u8 distance,count = 10; \r\n\t \r\n\t TX = 0;           // 发射引脚置0\r\n\t TL0 = 0xF4;       // 设置定时初值\r\n\t TH0 = 0xFF;       // 设置定时初值\r\n\t TR0 = 1;          // 打开定时器 0\r\n\t\r\n\t // TX 引脚发送 40kHz 方波信号驱动超声波发送探头\r\n\t while(count--) \r\n\t {\r\n\t\t while(!TF0);    // TF0溢出标志位为0是卡死，直至TF0满12us溢出，跳出循环\r\n\t\t TX ^= 1;        // 发送信号翻转\r\n\t\t TF0 = 0;        // 溢出标志位清零\r\n\t }\r\n\t \r\n\t TR0 = 0;          // 关闭定时器0，将其再次赋初值\r\n\t TL0 = 0;          // 设置定时初值\r\n\t TH0 = 0;          // 设置定时初值\r\n\t TR0 = 1;          // 打开定时器0\r\n\t \r\n\t while(RX &amp;&amp; !TF0);  // 等待收到脉冲，收到脉冲时RX将产生低电平，将跳出循环。并开始计时，1us计数加一\r\n\t TR0 = 0;            // 关闭定时器0，此时TL0、TH0被记录下来\r\n\t \r\n\t if(TF0)           // 测距大于1m时，发生溢出\r\n\t { \r\n\t\t TF0 = 0;        // 标志位清零\r\n\t\t distance = 255;   // 即0xff，表示超出测量范围\r\n\t } \r\n\t else              // 计算距离\r\n\t\tdistance = ((TH0&lt;&lt;8)+TL0)*0.017;   // t*0.000001(1us)*340/2(往返)*100(换算成厘米) = t * 0.017\r\n\r\n\t return distance; \r\n}</code></pre></div>\n<h3>3、整体代码</h3>\n<p>由于考虑初学者基础较为薄弱，因此将完整的 main.cpp 代码贴出来，包含中断函数、矩阵键盘、数码管显示等，并且在关键处进行了注释，希望对大家有所帮助。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// 包含头文件</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span> </span>\r\n<span class=\"token comment\">// 数据类型定义</span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u8</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u16</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span></span></span>\r\n<span class=\"token comment\">// 8位数码管状态</span>\r\nu8 dspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \r\nu8 code tab<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x24</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x19</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\t             <span class=\"token comment\">// 0     1    2    3    4    5    6    7    8    9    10   11   12   13   14   15   16  17   18   19   20       </span>\r\nu8 dspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\nbit key_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\r\n<span class=\"token comment\">//////////////////////////////////////////////////////////////////////////////////////////</span>\r\nsbit TX <span class=\"token operator\">=</span> P1<span class=\"token operator\">^</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 超声波发射引脚</span>\r\nsbit RX <span class=\"token operator\">=</span> P1<span class=\"token operator\">^</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 超声波接收引脚</span>\r\n<span class=\"token comment\">//////////////////////////////////////////////////////////////////////////////////////////</span>\r\n\r\n<span class=\"token comment\">// 573锁存器封装成函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">door</span><span class=\"token punctuation\">(</span>u8 choose<span class=\"token punctuation\">,</span>input<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tP2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P2 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> choose<span class=\"token punctuation\">;</span>\r\n\tP0 <span class=\"token operator\">=</span> input<span class=\"token punctuation\">;</span>\r\n\tP2 <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">;</span>\t\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 数码管关闭函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 关灯、蜂鸣器</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n \t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">clo_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token comment\">// 数码管显示函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\t\t\t  \r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x01</span><span class=\"token operator\">&lt;&lt;</span>dspcom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span>tab<span class=\"token punctuation\">[</span>dspbuf<span class=\"token punctuation\">[</span>dspcom<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>dspcom <span class=\"token operator\">>=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\r\n\t\tdspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 定时器1初始化，用于按键、数码管显示等</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer1Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">//2毫秒@12.000MHz</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tAUXR <span class=\"token operator\">|=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器时钟1T模式</span>\r\n\tTMOD <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x0F</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时器模式</span>\r\n\tTL1 <span class=\"token operator\">=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTH1 <span class=\"token operator\">=</span> <span class=\"token number\">0xA2</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTF1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//清除TF1标志</span>\r\n\tTR1 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器1开始计时</span>\r\n\t\r\n\tET1 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\tEA <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">//定时器0、12T时钟，用于超声波测距</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 12us@12.000MHz    频率：40KHZ,1/40000 = 25us，其中高电平12.5us，低电平12.5us，约12us</span>\r\n<span class=\"token punctuation\">{</span> \r\n\tAUXR <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x7F</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 定时器时钟12T模式 △</span>\r\n\tTMOD <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0xF0</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 设置定时器模式</span>\r\n\tTL0 <span class=\"token operator\">=</span> <span class=\"token number\">0xF4</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 设置定时初值</span>\r\n\tTH0 <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 设置定时初值</span>\r\n\tTF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 清除TF0溢出标志位</span>\r\n\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// 关闭定时器0  △</span>\r\n<span class=\"token punctuation\">}</span> \r\n\r\n<span class=\"token comment\">// 超声波接收函数</span>\r\nu8 <span class=\"token function\">Wave_recv</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> \r\n<span class=\"token punctuation\">{</span>\r\n\t u8 distance<span class=\"token punctuation\">,</span>count <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> \r\n\t \r\n\t TX <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 发射引脚置0</span>\r\n\t TL0 <span class=\"token operator\">=</span> <span class=\"token number\">0xF4</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 设置定时初值</span>\r\n\t TH0 <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 设置定时初值</span>\r\n\t TR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 打开定时器 0</span>\r\n\t\r\n\t <span class=\"token comment\">// TX 引脚发送 40kHz 方波信号驱动超声波发送探头</span>\r\n\t <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>count<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span> \r\n\t <span class=\"token punctuation\">{</span>\r\n\t\t <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>TF0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// TF0溢出标志位为0是卡死，直至TF0满12us溢出，跳出循环</span>\r\n\t\t TX <span class=\"token operator\">^=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 发送信号翻转</span>\r\n\t\t TF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 溢出标志位清零</span>\r\n\t <span class=\"token punctuation\">}</span>\r\n\t \r\n\t TR0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 关闭定时器0，将其再次赋初值</span>\r\n\t TL0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 设置定时初值</span>\r\n\t TH0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 设置定时初值</span>\r\n\t TR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">// 打开定时器0</span>\r\n\t \r\n\t <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>RX <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>TF0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 等待收到脉冲，收到脉冲时RX将产生低电平，将跳出循环。并开始计时，1us计数加一</span>\r\n\t TR0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// 关闭定时器0，此时TL0、TH0被记录下来</span>\r\n\t \r\n\t <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>TF0<span class=\"token punctuation\">)</span>           <span class=\"token comment\">// 测距大于1m时，发生溢出</span>\r\n\t <span class=\"token punctuation\">{</span> \r\n\t\t TF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 标志位清零</span>\r\n\t\t distance <span class=\"token operator\">=</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 即0xff，表示超出测量范围</span>\r\n\t <span class=\"token punctuation\">}</span> \r\n\t <span class=\"token keyword\">else</span>              <span class=\"token comment\">// 计算距离</span>\r\n\t\tdistance <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>TH0<span class=\"token operator\">&lt;&lt;</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>TL0<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">0.017</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// t*0.000001(1us)*340/2(往返)*100(换算成厘米) = t * 0.017</span>\r\n\r\n\t <span class=\"token keyword\">return</span> distance<span class=\"token punctuation\">;</span> \r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 主函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tu8 distance<span class=\"token punctuation\">;</span>\r\n\t<span class=\"token comment\">// 初始化</span>\r\n\t<span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">Timer1Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token comment\">// 20ms接收一次超声波，并进行数码管显示测距值</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_flag<span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token comment\">// 超声波接收</span>\r\n\t\t\tdistance <span class=\"token operator\">=</span> <span class=\"token function\">Wave_recv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token comment\">// 数码管显示测距值</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> distance<span class=\"token operator\">/</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> distance<span class=\"token operator\">%</span><span class=\"token number\">100</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> distance<span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// 定时器1中断服务函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">timer1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> interrupt <span class=\"token number\">3</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">static</span> u8 t_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\tt_20ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token comment\">// 20ms键盘扫描</span>\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_20ms <span class=\"token operator\">>=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>至此，本次 蓝桥杯所有模块 均已介绍完毕，希望对大家有所帮助！</p>","frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_超声波测距","date":"June 02, 2021","description":"本文介绍了蓝桥杯单片机编程大赛超声波测距模块的编程使用方法。"}},"previous":{"fields":{"slug":"/008 Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_NE555"}},"next":{"fields":{"slug":"/021_record_WebPlotDigitizer/"},"frontmatter":{"title":"【学习随记】科研神器_WebPlotDigitizer"}}},"pageContext":{"id":"a94ec4cc-c5e8-5490-9ddc-bfe822a34fff","previousPostId":"cfbbc231-c0ef-5db5-8b55-10b4e4529f4e","nextPostId":"0eaece25-c0c5-57e8-a2ba-437bb28c0793"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}