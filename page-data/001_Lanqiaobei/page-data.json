{"componentChunkName":"component---src-templates-blog-post-js","path":"/001_Lanqiaobei/","result":{"data":{"site":{"siteMetadata":{"title":"JokerDebug"}},"markdownRemark":{"id":"8f51c9f3-0ba0-5c49-88a9-3b5f0d570c83","excerpt":"Github代码仓库链接 一、前言 笔者在本科大二期间，参加了202…","html":"<p><a href=\"https://github.com/Joker001014/LanQiaoCup\">Github代码仓库链接</a></p>\n<h1>一、前言</h1>\n<p>笔者在本科大二期间，参加了2021年蓝桥杯单片机设计与开发组省赛，获省赛一等奖成功入围决赛，并获全国总决赛二等奖（证书见文末附录）。笔者将在接下来一个月的时间内不断更新关于蓝桥杯单片机设计与开发国赛的博文，初衷是与各位同学共勉，一起准备国赛，希望和大家共同取得佳绩。</p>\n<h2>二、标准模板</h2>\n<p>话不多说，我们直接进入正题。文章中所说的标准模板，其实是指包含了初始化函数、锁存器驱动、数码管驱动函数、矩阵键盘/独立键盘以及定时器中断等模块的可编译.c文件。\r\n笔者的标准模板并不是采用模块化编程，笔者认为定义包含多个LED、数码管等多个头文件看起来较为繁琐，对于新手不太友善。而应付蓝桥杯比赛、51单片机考试等，笔者以为通过采用“函数模块化”编程即可，故本模板在一个.c文件中分模块定义多个驱动函数，也是十分简洁、容易上手的。</p>\n<h3>1、创建工程</h3>\n<p>创建工程：依次点击菜单栏中 Project → New uvision Project... → 输入工程名称并保存 →  选择STC15F2K60S2（注：需通过 stc-isp 软件 Keil 仿真添加头文件）→ 点击 File 下方空白页新建空文件并命名为.c文件 → 双击 Source Group 将.c文件加入工程，就可以开始在文件中编写程序。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 569px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/5780e6c83e96a626c73e2077d8357394/17a45/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.55696202531647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtWyIBmVoD/8QAGBAAAgMAAAAAAAAAAAAAAAAAARACAzH/2gAIAQEAAQUCIcnZgX//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAcEAACAgIDAAAAAAAAAAAAAAAAARARIVExcYH/2gAIAQEAAT8hYqzXR6xtrZyRa2ODGo//2gAMAwEAAgADAAAAEMs/AP/EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxAr/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEREP/aAAgBAgEBPxCEW//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExEJFRYYH/2gAIAQEAAT8QoF+ggNbPsQAe0VIoHlg2AL6ZvrhyLNRbpn//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"创建工程1\"\n        title=\"\"\n        src=\"/blog/static/5780e6c83e96a626c73e2077d8357394/17a45/1.jpg\"\n        srcset=\"/blog/static/5780e6c83e96a626c73e2077d8357394/ff44c/1.jpg 158w,\n/blog/static/5780e6c83e96a626c73e2077d8357394/a6688/1.jpg 315w,\n/blog/static/5780e6c83e96a626c73e2077d8357394/17a45/1.jpg 569w\"\n        sizes=\"(max-width: 569px) 100vw, 569px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/6a068/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHuuTNEQ//EABcQAAMBAAAAAAAAAAAAAAAAAAABEBH/2gAIAQEAAQUCUYpp/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAERITFR/9oACAEBAAE/IbogWzBI26f/2gAMAwEAAgADAAAAEFAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFRYf/aAAgBAQABPxAAN3mwowKd57E0bd+xVOsRSrk//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"创建工程2\"\n        title=\"\"\n        src=\"/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/828fb/2.jpg\"\n        srcset=\"/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/ff44c/2.jpg 158w,\n/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/a6688/2.jpg 315w,\n/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/828fb/2.jpg 630w,\n/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/0ede0/2.jpg 945w,\n/blog/static/c40fbf0d2a5ac345b1baef9603bb2b03/6a068/2.jpg 960w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/414327fe73d477c8a71ef228d668013a/c08c5/3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe0gjI//xAAYEAEBAAMAAAAAAAAAAAAAAAAAARIhIv/aAAgBAQABBQKMlctK/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERIUFR/9oACAEBAAE/IaI9H0da1onyh1T/2gAMAwEAAgADAAAAEKPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQEAAgMAAAAAAAAAAAAAAREAIUFRcYH/2gAIAQEAAT8QEVCBvBX3VDesBFMHPO6DfWYZ0Tf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"创建工程3\"\n        title=\"\"\n        src=\"/blog/static/414327fe73d477c8a71ef228d668013a/828fb/3.jpg\"\n        srcset=\"/blog/static/414327fe73d477c8a71ef228d668013a/ff44c/3.jpg 158w,\n/blog/static/414327fe73d477c8a71ef228d668013a/a6688/3.jpg 315w,\n/blog/static/414327fe73d477c8a71ef228d668013a/828fb/3.jpg 630w,\n/blog/static/414327fe73d477c8a71ef228d668013a/c08c5/3.jpg 640w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b6df8b518ee7496fb9388345874a2995/0f98f/4.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd5pFEh//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFRABAQAAAAAAAAAAAAAAAAAAASD/2gAIAQEAAT8hAK//2gAMAwEAAgADAAAAEFAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAITH/2gAIAQEAAT8QcQNCTQNDTmVvu//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"创建工程4\"\n        title=\"\"\n        src=\"/blog/static/b6df8b518ee7496fb9388345874a2995/828fb/4.jpg\"\n        srcset=\"/blog/static/b6df8b518ee7496fb9388345874a2995/ff44c/4.jpg 158w,\n/blog/static/b6df8b518ee7496fb9388345874a2995/a6688/4.jpg 315w,\n/blog/static/b6df8b518ee7496fb9388345874a2995/828fb/4.jpg 630w,\n/blog/static/b6df8b518ee7496fb9388345874a2995/0ede0/4.jpg 945w,\n/blog/static/b6df8b518ee7496fb9388345874a2995/3ac88/4.jpg 1260w,\n/blog/static/b6df8b518ee7496fb9388345874a2995/0f98f/4.jpg 1920w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>2、编程准备</h3>\n<p>（1）首先，包含头文件。对于蓝桥杯单片机设计与开发大赛采用的单片机为 IAP15 系列单片机，型号为：IAP15F2K61S2，头文件使用“STC15F2K60S2.h”即可（本文章将以此为例）。若采用“reg52.h”需在头文件中添加AUXR、SCON等特殊寄存器，以免影响串口及一些芯片的正常编程。\r\n而对于刚入门的新手，使用 STC89S52 单片机编写简单的 LED、数码管、键盘等程序，使用“reg52.h”头文件足矣。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"STC15F2K60S2.h\"</span>   <span class=\"token comment\">//头文件</span></span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u8</span> <span class=\"token expression\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span>    </span><span class=\"token comment\">//宏定义常用类型</span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">u16</span> <span class=\"token expression\">unsinged <span class=\"token keyword\">int</span> </span></span>\r\n\t\r\nu8 dspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//定义缓冲区</span>\r\nu8 code tab<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//定义数组存放数码管数字1~9和熄灭状态</span></code></pre></div>\n<h3>3、锁存器驱动函数</h3>\n<p>笔者主函数前编写锁存器驱动函数，将为接下来的数码管驱动、主函数功能等程序的编写带来极大的益处，十分便捷。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">door</span><span class=\"token punctuation\">(</span>u8 choose<span class=\"token punctuation\">,</span>input<span class=\"token punctuation\">)</span>    <span class=\"token comment\">//数码管驱动函数</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tP2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P2<span class=\"token operator\">&amp;</span><span class=\"token number\">0x1f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> choose<span class=\"token punctuation\">;</span>    <span class=\"token comment\">//相与空出高3位，choose输入打通锁存器</span>\r\n\tP0 <span class=\"token operator\">=</span> input<span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//送入数据</span>\r\n\tP2 <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//关闭锁存器</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>4、数码管驱动函数</h3>\n<p>数码管显示数字 0~9 采用了编程准备步骤中的 dspbuf 缓冲区及数组 tab ，我们通过改变 dspbuf 数组中对应的八个数字即可改变八个数码管显示的数字。例：dspbuf [0] = 8;将在第一个数码管上显示数字“8”。\r\n语句 door(0xe0,tab[dspbuf[dspcom++]])  原理其实很简单：通过初始化语句 dspbuf [0] = 8，使得 dspbuf 数组选中第一个缓冲区（即显示第一个数码管），而 tab 数组将选中第八个数，第八个数“0x80”对应的将在数码管中显示数字“8”（对于数码管显示数字的二进制代码计算这里不再赘述）。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">u8 dspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>                       <span class=\"token comment\">//定义数码管点亮位数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>                       <span class=\"token comment\">//数码管驱动函数</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                   <span class=\"token comment\">//消隐</span>\r\n\t\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x01</span><span class=\"token operator\">&lt;&lt;</span>dspcom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//位选</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span>tab<span class=\"token punctuation\">[</span>dspbuf<span class=\"token punctuation\">[</span>dspcom<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//段选</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>dspcom <span class=\"token operator\">>=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>                    <span class=\"token comment\">//初始化位数，动态循环</span>\r\n\t\tdspcom <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>5、初始化函数</h3>\n<h4>（1）LED、蜂鸣器等初始化</h4>\n<p>笔者在初始化函数 all_init 前定义数码管熄灭函数，主要目的是便于在设计比赛试题各种功能时熄灭数码管，避免各个功能相互干涉，使用较为方便，程序更加简洁。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">num_close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//熄灭数码管</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n\tdspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\t\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//初始化函数</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//熄灭LED</span>\r\n\t<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//关闭蜂鸣器、继电器</span>\r\n\t<span class=\"token function\">num_close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//熄灭数码管</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<h3>（2）定时器初始化</h3>\n<p>定时器初始化函数，这里主要对本校自动化专业的学弟学妹们有一些寄语，在你们初步接触51单片机时可能会认为定时中断很难、看不懂，但其实并不是这样的。对于定时器中断，只要肯花点时间去看，其实是很容易掌握的（建议学弟学妹们多花点功夫把这篇文章阅读完)。掌握之后通过中断动态显示数码管，以及用中断设置计时、LED定时闪烁，在科创的结课测试是非常好用的。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">//定时器0初始化函数</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">//2毫秒@12.000MHz</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tAUXR <span class=\"token operator\">|=</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器时钟1T模式</span>\r\n\tTMOD <span class=\"token operator\">&amp;=</span> <span class=\"token number\">0xF0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时器模式</span>\r\n\tTL0 <span class=\"token operator\">=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTH0 <span class=\"token operator\">=</span> <span class=\"token number\">0xA2</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//设置定时初值</span>\r\n\tTF0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//清除TF0标志</span>\r\n\tTR0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//定时器0开始计时</span>\r\n\t\r\n\tEA <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//打开总中断</span>\r\n\tET0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//打开定时器0中断</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>定时器初始化函数这里需要说明一下，函数内容看上去非常繁琐，对于新手可能觉得一脸懵。但其实定时器初始化函数可通过 STC-ISP 软件中的“定时器计算器”进行代码生成，再加上对应的定时器开关即可。具体操作步骤如下：点击“定时器计算机”按钮，设置系统频率为对应频率（这里以12MHZ为例），设置定时长度为2ms，其余选项保持默认，复制代码即可（注：版本较低的 STC-ISP 软件需点击生成c代码，再点击复制按钮）。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/44075f5821fec0e91f066cb529108195/2c24f/5.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.15189873417721%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHWeuRgD//EABgQAQEAAwAAAAAAAAAAAAAAAAEAAhEh/9oACAEBAAEFApGcYelu/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAECAx/9oACAEBAAY/AhU//8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERITFRgf/aAAgBAQABPyFbURZ2bciDQaPXfBj/2gAMAwEAAgADAAAAEGPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAQEBAQEAAAAAAAAAAAAAAREhADFR/9oACAEBAAE/EEoLjq9VSqibM+9kqQ94IjV+51m1uYJxXx7/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"定时器初始化\"\n        title=\"\"\n        src=\"/blog/static/44075f5821fec0e91f066cb529108195/828fb/5.jpg\"\n        srcset=\"/blog/static/44075f5821fec0e91f066cb529108195/ff44c/5.jpg 158w,\n/blog/static/44075f5821fec0e91f066cb529108195/a6688/5.jpg 315w,\n/blog/static/44075f5821fec0e91f066cb529108195/828fb/5.jpg 630w,\n/blog/static/44075f5821fec0e91f066cb529108195/2c24f/5.jpg 817w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>6、矩阵键盘</h3>\n<p>在书写矩阵键盘的程序前，我们先看一下原理图（2.0版本）。对于蓝桥杯单片机2.0版本，即IAP15系列单片机的需要注意的是图中WR、RD引脚替换成P42、P44引脚，因此书写程序时可采取变量代换。同时，对于STC89C52系列单片机的则省去变量代换。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/53d2d/6.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe3NiA//xAAXEAADAQAAAAAAAAAAAAAAAAAAAREg/9oACAEBAAEFAnmH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAERITEQUf/aAAgBAQABPyGV6Ob3BOt5BDxH/9oADAMBAAIAAwAAABBwz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAAMAAQUBAAAAAAAAAAAAAAABETEhQVGRocH/2gAIAQEAAT8QZlOWJRq1bA5p9kUwRwuhtd8j/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/828fb/6.jpg\"\n        srcset=\"/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/ff44c/6.jpg 158w,\n/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/a6688/6.jpg 315w,\n/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/828fb/6.jpg 630w,\n/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/0ede0/6.jpg 945w,\n/blog/static/b4342f616f7f1103e3d6d54cc4173c9d/53d2d/6.jpg 999w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n程序中都注有详细的注释，因此这里不再解释，如若有不懂的同学欢迎评论区提问。同时，笔者仅以矩阵键盘为例，对于独立键盘则同理且更加简单，这里也不再赘述。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">u8 keypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>keyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span>  \r\nu8 <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tu8 key_m<span class=\"token punctuation\">,</span>cal<span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token comment\">//检测按键列数</span>\r\n\tP3 <span class=\"token operator\">=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">;</span>P42 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n\tP36 <span class=\"token operator\">=</span> P42<span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> P37<span class=\"token punctuation\">;</span>   <span class=\"token comment\">//变量代换，区别于STC89C52系列单片机</span>\r\n\tkey_m <span class=\"token operator\">=</span> P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0xf0</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">!=</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">)</span>\r\n\t\tkeypress<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">//识别到按键</span>\r\n\t<span class=\"token keyword\">else</span>\r\n\t\tkeypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">//按键抖动</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>keypress <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//多次检测，避免误判</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tkeypress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">//清空按键计数</span>\r\n\t\tkeyread <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//读取按键标志位</span>\r\n\t\t\r\n\t\t<span class=\"token comment\">//列数判断</span>\r\n\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x70</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第一列</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0xb0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第二列</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0xd0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第三列</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0xe0</span><span class=\"token operator\">:</span>cal <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第四列</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\r\n\t\t<span class=\"token comment\">//检测按键行数</span>\r\n\t\tP3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\t\tkey_m <span class=\"token operator\">=</span> P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>\r\n\t\t\r\n\t\t<span class=\"token comment\">//行数判断</span>\r\n\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_m<span class=\"token punctuation\">)</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0e</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">7</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第一行</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0d</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">6</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第二行</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x0b</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第三行</span>\r\n\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">0x07</span><span class=\"token operator\">:</span>keyvalue <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token operator\">*</span>cal<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//检测到第四行</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n\t\r\n\t<span class=\"token comment\">//再次赋值检测松手</span>\r\n\tP3 <span class=\"token operator\">=</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>P42 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>P44 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\tkey_m <span class=\"token operator\">=</span> P3<span class=\"token operator\">&amp;</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>keyread<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>key_m <span class=\"token operator\">==</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//松手检测</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tkeyread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>                    <span class=\"token comment\">//清空读取标志位</span>\r\n\t\t<span class=\"token keyword\">return</span> keyvalue<span class=\"token punctuation\">;</span>                <span class=\"token comment\">//返回读到的按键</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">//未识别到按键</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>7、中断函数</h3>\n<p>首先，由前文可知定时器初始化函数中定义了 2ms 产生一次中断，因此笔者将数码管显示函数 display 放在中断里，并定义了静态变量计时每 20ms 将按键标志位置一，在主函数中识别按键，可避免按键抖动带来的影响。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">bit key_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//定义按键标志位</span>\r\n<span class=\"token keyword\">void</span> <span class=\"token function\">timer0</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> interrupt <span class=\"token number\">1</span>    <span class=\"token comment\">//定义中断模式1</span>\r\n<span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">static</span> u8 t_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//定义静态变量计时20ms</span>\r\n\t\r\n\t<span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//数码管显示函数</span>\r\n\t\r\n\tt_20ms<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\">//计数自增</span>\r\n\t\r\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t_20ms <span class=\"token operator\">>=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>           <span class=\"token comment\">//判断计时时间</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\tt_20ms <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">//计数清零</span>\r\n\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//按键标志位置1</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>三、应用示例</h2>\n<h3>1、锁存器驱动函数</h3>\n<p>LED：由原理图可知，选中控制 LED 的芯片 M74HC573M1R 需要打通锁存器 Y4C。对应的二进制代码为：100 0 0000（100转换为十进制即为4，Y4C），即0x80。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 306px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/bc28507f3f37f95662916fbc432f7659/01fdd/7.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyIWA//xAAWEAEBAQAAAAAAAAAAAAAAAAAAIQL/2gAIAQEAAQUCrKv/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8CIv/EABoQAAICAwAAAAAAAAAAAAAAAAABESFRcdH/2gAIAQEAAT8hat0aVfciyaP/2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBAAAQQDAQAAAAAAAAAAAAAAEQABITFBUWGR/9oACAEBAAE/EAb3Ax8hNVw6SmMJE6C//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Y4C\"\n        title=\"\"\n        src=\"/blog/static/bc28507f3f37f95662916fbc432f7659/01fdd/7.jpg\"\n        srcset=\"/blog/static/bc28507f3f37f95662916fbc432f7659/ff44c/7.jpg 158w,\n/blog/static/bc28507f3f37f95662916fbc432f7659/01fdd/7.jpg 306w\"\n        sizes=\"(max-width: 306px) 100vw, 306px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n再通过 P0 口输入需要点亮 LED 对应的十六进制代码。注意：原理图中采用共阳极接法，因此对应的端口输入低电平即可点亮相应的 LED。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/b3d5a/8.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.37974683544304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2wUH/8QAGBAAAgMAAAAAAAAAAAAAAAAAABEBAkH/2gAIAQEAAQUC1WFJ/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFRABAQAAAAAAAAAAAAAAAAAAADH/2gAIAQEABj8CVX//xAAXEAEBAQEAAAAAAAAAAAAAAAABQQAQ/9oACAEBAAE/IUa4Su//2gAMAwEAAgADAAAAEPAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAMBAQAAAAAAAAAAAAAAAQARMSGB/9oACAEBAAE/EDANFFy56PCCNGf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/828fb/8.jpg\"\n        srcset=\"/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/ff44c/8.jpg 158w,\n/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/a6688/8.jpg 315w,\n/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/828fb/8.jpg 630w,\n/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/0ede0/8.jpg 945w,\n/blog/static/dec26e7f0dc5177339a4feb85b1b4ece/b3d5a/8.jpg 1114w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n例：</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//0000 0000：点亮所有LED</span>\r\n<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//1111 1111：熄灭所有LED</span>\r\n<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaa</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//1010 1010：点亮第1、3、5、7个LED</span></code></pre></div>\n<p>蜂鸣器、继电器：由原理图可知，选中控制蜂鸣器、继电器的芯片 M74HC573M1R 需要打通锁存器Y5C。对应的二进制代码为：101 0 0000（101转换为十进制即为5，Y5C），即0xa0。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 303px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/696b10e49cf3b1fa65319f837ece4162/c8fe0/9.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3JCwf//EABYQAQEBAAAAAAAAAAAAAAAAAAAhAv/aAAgBAQABBQKsq//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAAAAQIf/aAAgBAQAGPwIi/8QAGRAAAgMBAAAAAAAAAAAAAAAAADERQYGh/9oACAEBAAE/IbMTuTJ//9oADAMBAAIAAwAAABDzz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAAIDAQAAAAAAAAAAAAAAAAERADFhIf/aAAgBAQABPxDO5VQmhF63LHueGf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Y5C\"\n        title=\"\"\n        src=\"/blog/static/696b10e49cf3b1fa65319f837ece4162/c8fe0/9.jpg\"\n        srcset=\"/blog/static/696b10e49cf3b1fa65319f837ece4162/ff44c/9.jpg 158w,\n/blog/static/696b10e49cf3b1fa65319f837ece4162/c8fe0/9.jpg 303w\"\n        sizes=\"(max-width: 303px) 100vw, 303px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n再通过 P0 口输入相应的十六进制代码。由图可见，控制蜂鸣器的 BUZZ 引脚由 P06 引脚控制，给予 P06 引脚一个高电平即可打开蜂鸣器；同理，控制继电器的 RELAY 引脚由 P04 引脚控制，给予 P04 引脚一个高电平即可打开继电器；其余 P0 口置1即可。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c1caec4eb3855f60161492dfaf04265f/50376/10.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAduAsD//xAAYEAACAwAAAAAAAAAAAAAAAAAAAREhQf/aAAgBAQABBQLbFJ//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAEBAQEAAAAAAAAAAAAAAAABAFER/9oACAEBAAE/IXoMhmt//9oADAMBAAIAAwAAABBwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAQADAQEAAAAAAAAAAAAAAAEAESExgf/aAAgBAQABPxA2aNOrA0c76xVcO5tT/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/c1caec4eb3855f60161492dfaf04265f/828fb/10.jpg\"\n        srcset=\"/blog/static/c1caec4eb3855f60161492dfaf04265f/ff44c/10.jpg 158w,\n/blog/static/c1caec4eb3855f60161492dfaf04265f/a6688/10.jpg 315w,\n/blog/static/c1caec4eb3855f60161492dfaf04265f/828fb/10.jpg 630w,\n/blog/static/c1caec4eb3855f60161492dfaf04265f/50376/10.jpg 793w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n例：</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xaf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//1010 1111 关闭蜂鸣器、继电器</span>\r\n<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xef</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//1110 1111 打开蜂鸣器，关闭继电器</span>\r\n<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xbf</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//1011 1111 关闭你蜂鸣器，打开继电器</span></code></pre></div>\n<h3>2、数码管驱动函数</h3>\n<p>数码管：前文提到的数码管驱动函数，同样是对于 M74HC573M1R 芯片。笔者通过打通锁存器Y6C，控制数码管位选，对应的二进制代码为：110 0 0000（110转换为十进制即为6，Y6C），即0xc0；通过打通锁存器Y7C，控制数码管段选，对应的二进制代码为：111 0 0000（111转换为十进制即为7，Y7C），即0xe0；\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 297px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/0c6ebe096298907a4c2f09bc2499e133/c43cc/11.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2wWD/8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEhEv/aAAgBAQABBQK5RT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAECJB/9oACAEBAAY/AtJX/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEhQWFxkfH/2gAIAQEAAT8hfQTVCuZLR//aAAwDAQACAAMAAAAQAA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhoTFR/9oACAEBAAE/EBYSpsA9xQFD2HmAbW3r47n/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/0c6ebe096298907a4c2f09bc2499e133/c43cc/11.jpg\"\n        srcset=\"/blog/static/0c6ebe096298907a4c2f09bc2499e133/ff44c/11.jpg 158w,\n/blog/static/0c6ebe096298907a4c2f09bc2499e133/c43cc/11.jpg 297w\"\n        sizes=\"(max-width: 297px) 100vw, 297px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 303px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/14f028697fc4ef6ffa8fc967dbc59802/c8fe0/12.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.87341772151899%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyAuD//xAAWEAEBAQAAAAAAAAAAAAAAAAAAIQH/2gAIAQEAAQUCrFf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8CIv/EABsQAAEEAwAAAAAAAAAAAAAAAAABESExQYGh/9oACAEBAAE/IcrFx25of//aAAwDAQACAAMAAAAQAA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFh/9oACAEBAAE/EHIrtqqYyBOevYd2/OM//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/14f028697fc4ef6ffa8fc967dbc59802/c8fe0/12.jpg\"\n        srcset=\"/blog/static/14f028697fc4ef6ffa8fc967dbc59802/ff44c/12.jpg 158w,\n/blog/static/14f028697fc4ef6ffa8fc967dbc59802/c8fe0/12.jpg 303w\"\n        sizes=\"(max-width: 303px) 100vw, 303px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n再通过 P0 口输入相应的十六进制代码即可点亮响应的数码管段。注意：原理图中各数码管段采用共阳极接法，因此对应的输入端输入低电平即可点亮相应的数码管段。\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/09753/13.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe42iFj/xAAXEAADAQAAAAAAAAAAAAAAAAAAEEEh/9oACAEBAAEFAqaVf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAACAx/9oACAEBAAY/Aqv/xAAXEAADAQAAAAAAAAAAAAAAAAABECEA/9oACAEBAAE/IcWoQH//2gAMAwEAAgADAAAAENPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAMAAwEAAAAAAAAAAAAAAQARIRBBcbH/2gAIAQEAAT8QbrWM+wNqzcuAQoH1ihZ1z//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"在这里插入图片描述\"\n        title=\"\"\n        src=\"/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/828fb/13.jpg\"\n        srcset=\"/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/ff44c/13.jpg 158w,\n/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/a6688/13.jpg 315w,\n/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/828fb/13.jpg 630w,\n/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/0ede0/13.jpg 945w,\n/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/3ac88/13.jpg 1260w,\n/blog/static/e032a9e2e5a52fc29b89ba2452784fb7/09753/13.jpg 1389w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n接下来分析一下上文的数码管驱动函数中的剩余语句。语句 door(0xe0,0xff) 通过打通锁存器 Y7C 对数码管段选，输入 0xff（1111 1111）熄灭数码管，屏蔽前一时刻数码管状态实现消隐；再通过语句 door(0xc0,0x01&#x3C;&#x3C;dspcom) 打通锁存器 Y6C ，输入不同值进行位选；最后调用语句 door(0xe0,tab[dspbuf[dspcom++]]) 进行段选输入点亮不同状态的数码管。\r\n例：</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                   <span class=\"token comment\">//消隐</span>\r\n\t\r\n<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x01</span><span class=\"token operator\">&lt;&lt;</span>dspcom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//位选</span>\r\n<span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span>tab<span class=\"token punctuation\">[</span>dspbuf<span class=\"token punctuation\">[</span>dspcom<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//段选</span></code></pre></div>\n<h3>3、主函数</h3>\n<p>主函数：即为调用前文编写的各种驱动函数。笔者通过在中断中定义按键识别标志位 key_flag，每 20 秒扫描读取一次按键，将按键返回值存取在变量 key_re 中，再通过 case 语句实现不同按键控制不同功能（通过按键调参，可节约不少时间）。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">//主函数</span>\r\n<span class=\"token punctuation\">{</span>\r\n\tu8 key_re<span class=\"token punctuation\">;</span>     <span class=\"token comment\">//定义变量读取按键返回值</span>\r\n\t\r\n\t<span class=\"token function\">all_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//初始化函数</span>\r\n\t<span class=\"token function\">Timer0Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//定时器0初始化</span>\r\n\t\r\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_flag<span class=\"token punctuation\">)</span>            <span class=\"token comment\">//每20ms扫描一次按键</span>\r\n\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\tkey_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">//标志位置0</span>\r\n\t\t\tkey_re <span class=\"token operator\">=</span> <span class=\"token function\">Read_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//读取按键</span>\r\n\t\t\t \r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key_re <span class=\"token operator\">!=</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//判断按键是否按下</span>\r\n\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t<span class=\"token comment\">//判断按键</span>\r\n\t\t\t\t<span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key_re<span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">{</span>\r\n\t\t\t\t\t<span class=\"token comment\">//放入需要执行的功能</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token operator\">:</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">7</span><span class=\"token operator\">:</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">8</span><span class=\"token operator\">:</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">9</span><span class=\"token operator\">:</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">10</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">11</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">12</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">13</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">14</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">15</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">18</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">19</span><span class=\"token operator\">:</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n\t\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t\t<span class=\"token punctuation\">}</span>\r\n\t\t<span class=\"token punctuation\">}</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>例：</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span><span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//按下按键4，点亮所有LED</span>\r\n<span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span><span class=\"token function\">door</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//按下按键5，打开蜂鸣器、继电器</span>\r\n<span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token operator\">:</span>dspbuf<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//按下按键6,第一位数码管显示数字1</span></code></pre></div>\n<p>到此，蓝桥杯单片机设计与开发_标准模板兼新手入门STC89C52系列单片机基础模板讲解到此结束啦！</p>\n<p>附录：证书\r\n<img src=\"./0.JPG\" alt=\"证书1\">\r\n<img src=\"./00.JPG\" alt=\"证书2\"></p>","frontmatter":{"title":"蓝桥杯单片机设计与开发_标准模版","date":"May 09, 2021","description":"本文介绍了蓝桥杯单片机编程大赛标准模板，涵盖了初始化函数、锁存器驱动、数码管驱动函数、矩阵键盘/独立键盘以及定时器中断等模块的可编译.c文件。"}},"previous":{"fields":{"slug":"/new-beginnings/"},"frontmatter":{"title":"New Beginnings"}},"next":{"fields":{"slug":"/002_Lanqiaobei/"},"frontmatter":{"title":"蓝桥杯单片机设计与开发_基础模块_DS18B20"}}},"pageContext":{"id":"8f51c9f3-0ba0-5c49-88a9-3b5f0d570c83","previousPostId":"3ff0862a-416f-50ce-8619-ee20425fa6a8","nextPostId":"5c4bee41-8355-5207-900c-51c12e934afd"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}